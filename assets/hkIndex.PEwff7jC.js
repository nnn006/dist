import{m as ne,d as ie,j as le,c as ce,f as re,w as de,x as ue,A as me,M as P,L as he,u as pe,b as fe,B as ve,y as Ie,z as _e,C as ye,D as ke,o as ge}from"./index.C__3lhMr.js";import{l as we,r,J as Se,b as be,d as De,K as _,L as u,U as xe,V as m,N as e,k as l,O as d,u as c,D as H,z as Ne,M as p,Q as M,F as $,S as j}from"./vue.C2TeXnf4.js";import{_ as Te}from"./HDetailsOptions.vue_vue_type_style_index_0_lang.Bo0YUPQB.js";import{A as Ae}from"./index.DcHIdklB.js";const Ce=e("span",null,null,-1),Le={class:"hk-home-box hk-pt-noScreen"},Oe={class:"hkh-btn-box"},Pe={class:"hkh-imp-apply"},He={class:"hkh-imp-wite-news hkh-imp-wn-bd hk-flex hk-jbetween hk-items-center"},Me={class:"hkh-imp-wn-l hk-flex hk-items-center"},$e=e("div",{class:"hkh-imp-wn-label"},"备用金: ",-1),je={class:"hk-fw-600"},Be={class:"hkh-imp-wn-r"},ze={class:"hkh-imp-wite-news hk-flex hk-jbetween hk-items-center"},Ue=e("div",{class:"hkh-imp-wn-l hk-flex hk-items-center"},[e("div",{class:"hkh-imp-wn-label"},"待处理消息: ")],-1),Ve={class:"hkh-imp-wn-r"},qe={class:"home-pay-class-box"},Je={class:"hdetails-card-header hdetails-card-p hk-flex hk-jbetween hk-items-center"},Re={class:"hdetails-card-tit"},Qe=e("span",{class:"hdetails-card-more"},null,-1),Fe={class:"home-pay-class-content hk-flex"},Ee={key:0,class:"data-empty-fbox"},Ke={class:"home-staff-box"},Ge=e("div",{class:"hdetails-card-header hdetails-card-p hk-flex hk-jbetween hk-items-center"},[e("span",{class:"hdetails-card-tit"},"员工"),e("span",{class:"hdetails-card-more"})],-1),We={class:"home-staff-content"},Xe=["onClick"],Ye={class:"home-staff-t hk-flex hk-jbetween"},Ze={class:"home-staff-tl"},et=["src"],tt={class:"home-staff-name"},at={class:"home-staff-tr"},st={class:"home-staff-b hk-flex hk-jbetween"},ot={class:"home-staff-bl"},nt={class:"hdetails-member-item hk-flex hk-items-center"},it={class:"hk-fw-600"},lt={class:"home-staff-br"},ct={key:0,class:"data-empty-fbox"},pt=we({name:"HkIndex",__name:"hkIndex",setup(rt){const{t:B}=pe(),{auth:x}=ne(),{pushName:y}=ie(),k=r(0),z=Se(),o=le(),f=r({}),N=r(0),{pageLoading:U,endPageLoading:V}=ce({activeAction:L}),{showLoading:q,closeLoading:J}=fe(),T=r({amount:0}),n=r(new Date().getTime()),S=r([]),v=be({list:[],currency:""});let I=null;const g=r(!1),R=r([{name:x===3?"划拨备用金":"发放备用金",value:5},{name:"收回备用金",value:7},{name:"员工备用金详情",value:"StatisticDetails"}]),A=a=>new Promise(s=>{ve({homeId:o.userInfo.homeId,selectTime:Math.floor(n.value/1e3)}).then(t=>{t.code===0&&(f.value={title:t.data.nickname,currency:t.data.currency,pic:t.data.avatar,id:t.data.homeId,statistic:[{label:"homeItem.payMoney",value:t.data.payMoney,type:"price",haveInfoArrow:!0,routeName:"StatisticDetails",otherQuery:{homeId:o.userInfo.homeId,qtime:n.value,pageTp:1,fee:0},setSession:{time:n.value}},{label:"homeItem.carTime",value:t.data.useCarTime,type:"time",haveInfoArrow:!0,routeName:"StatisticDetails",otherQuery:{homeId:o.userInfo.homeId,qtime:n.value,pageTp:3,fee:0},setSession:{time:n.value}},{label:"homeItem.preImprest",value:t.data.amount,type:"number",haveInfoArrow:!0,routeName:"StatisticDetails",otherQuery:{homeId:o.userInfo.homeId,qtime:n.value,pageTp:2,fee:0},setSession:{time:n.value}},{label:"homeItem.staffNum",value:t.data.employeesNum,type:"people",haveInfoArrow:!0,routeName:"StaffManage",otherQuery:{homeId:o.userInfo.homeId}}]})}).finally(()=>{s(!0)})}),Q=async a=>{n.value=new Date(a).getTime(),q(),await A(),J()},h=(a,s)=>{const t={name:a};s&&(t.query=s),z.push(t)},F=()=>new Promise(a=>{ye({homeId:o.userInfo.homeId,selectTime:Math.floor(n.value/1e3),selectTimeTyp:2}).then(s=>{s.code===0&&(v.currency=s.data.currency,v.list=s.data.list.map(t=>({type:"number",label:t.expenseType,value:t.payMoney,expenseTypeId:t.expenseTypeId})))}).finally(()=>{a(!0)})}),E=()=>new Promise(a=>{ke({page:1,pageSize:999,homeId:o.userInfo.homeId,selectTime:Math.floor(n.value/1e3)}).then(s=>{s.code===0&&(S.value=s.data.list.map(t=>({picture:ge+t.avatar,name:t.nickname,id:t.identifyId,amount:t.amount,currency:t.currency,jop:{label:"homeItem.jop",value:t.duties,type:"text"},residueImprest:{value:"",type:"price",label:"homeItem.residueImprest"},doTask:{value:t.useCarTime,type:"time",label:"homeItem.carTime"}})))}).finally(()=>{a(!0)})}),K=a=>{window.sessionStorage.setItem("toStatic",JSON.stringify({time:n.value})),h("StatisticDetails",{homeId:o.userInfo.homeId,qtime:n.value,pageTp:1,fee:a.expenseTypeId})},G=()=>{Ie({homeId:o.userInfo.homeId}).then(a=>{a.code===0&&(N.value=a.data.untreatedNum)})},W=()=>{y("DataReview",{homeId:o.userInfo.homeId})},X=a=>{},Y=()=>{y("Pay",{homeId:o.userInfo.homeId,currency:f.value.currency})},Z=a=>{window.sessionStorage.setItem("toStatic",JSON.stringify({time:n.value})),h("StatisticDetails",{homeId:o.userInfo.homeId,pageTp:a,qtime:n.value,fee:0})},ee=a=>{I=a,g.value=!0},C=()=>{g.value=!1,I=null},te=a=>{a.value==="StatisticDetails"?(window.sessionStorage.setItem("toStatic",JSON.stringify({time:n.value})),h("StatisticDetails",{homeId:o.userInfo.homeId,pageTp:2,fee:0,qtime:n.value,stfId:I.id})):h("ImpOperation",{homeId:o.userInfo.homeId,id:I.id,currency:I.currency,doType:a.value}),C()},ae=()=>{Promise.all([A(),F(),E()]).then(()=>{V()})};async function L(){const a=window.sessionStorage.getItem("toStatic");a&&(n.value=JSON.parse(a).time,window.sessionStorage.removeItem("toStatic")),ae(),G(),o.setUserIdent(),await o.putSurplusRes(),await o.putNotifyNum(),k.value=o.untreatedSelfNum,T.value=o.surplusRes}return De(async()=>{L()}),(a,s)=>{const t=_("SecondHeader"),se=_("SvgIcon"),w=_("DataInfoItem"),O=_("hk-empty"),oe=_("MainContainer");return u(),xe(oe,{exitLoading:!0,pageLoading:c(U),isBg:!0},{header:m(()=>[e("div",null,[l(re,{title:"管家系统",haveLiftEle:!1}),l(de,{onOnSelectTime:Q,timeValue:n.value},{title:m(()=>[Ce]),_:1},8,["timeValue"])])]),headerScreen:m(()=>[l(t,{noScreen:!0})]),default:m(()=>[e("div",Le,[l(ue,{data:f.value,haveInfoArrow:!1,onClick:s[0]||(s[0]=i=>X(f.value))},null,8,["data"]),e("div",Oe,[l(Te,{onOnFirBtnHandle:s[1]||(s[1]=()=>Y()),onOnSecBtnHandle:W,contentNumber:N.value},null,8,["contentNumber"])]),e("div",Pe,[e("div",He,[e("div",Me,[$e,e("div",je,d(c(me)(T.value.amount))+" "+d(f.value.currency),1)]),e("div",Be,[l(c(P),{plain:"",class:"hkh-imp-wn-btn active",size:"mini",onClick:s[2]||(s[2]=i=>c(y)("ImpApply"))},{default:m(()=>[H(d(c(B)("base.applyTxt"))+" ",1),l(se,{class:"add-apply-icon",iconClass:"add-small-icon",color:"#25D4D0"})]),_:1})])]),e("div",ze,[Ue,e("div",Ve,[l(c(he),{class:"hkh-imp-wn-badge",content:k.value,"show-zero":!1},null,8,["content"]),l(c(P),{plain:"",class:Ne(["hkh-imp-wn-btn",{active:k.value>0}]),size:"mini",onClick:s[3]||(s[3]=i=>c(y)("HkDealNews"))},{default:m(()=>[H(d(k.value>0?"去处理":"暂无消息"),1)]),_:1},8,["class"])])])]),e("div",qe,[e("div",Je,[e("span",Re,"支出分类("+d(v.currency)+")",1),Qe]),e("div",Fe,[(u(!0),p($,null,M(v.list,(i,b)=>(u(),p("div",{class:"pay-class-item",key:b},[l(w,{valData:i,haveArrow:!0,onOnHandle:K},null,8,["valData"])]))),128)),v.list.length===0?(u(),p("div",Ee,[l(O)])):j("",!0)])]),e("div",Ke,[Ge,e("div",We,[(u(!0),p($,null,M(S.value,(i,b)=>(u(),p("div",{class:"home-staff-item",key:b,onClick:D=>h("StaffDetails",{id:i.id,homeId:c(o).userInfo.homeId})},[e("div",Ye,[e("div",Ze,[e("img",{class:"home-staff-img",src:i.picture,alt:""},null,8,et),e("div",tt,d(c(_e)(i.name,6)),1)]),e("div",at,[l(w,{valData:i.jop,haveArrow:!0,onOnHandle:D=>h("StaffDetails",{id:i.id,homeId:c(o).userInfo.homeId})},null,8,["valData","onOnHandle"])])]),e("div",st,[e("div",ot,[l(w,{haveArrow:!0,valData:i.residueImprest,onOnHandle:D=>ee({id:i.id,currency:i.currency})},{default:m(()=>[e("div",nt,[e("span",it,d(i.amount),1),e("span",null,d(i.currency),1)])]),_:2},1032,["valData","onOnHandle"])]),e("div",lt,[l(w,{valData:i.doTask,haveArrow:!0,onOnHandle:s[4]||(s[4]=D=>Z(3))},null,8,["valData"])])])],8,Xe))),128)),S.value.length===0?(u(),p("div",ct,[l(O)])):j("",!0)])])]),l(c(Ae),{class:"hk-action-sheet",show:g.value,"onUpdate:show":s[5]||(s[5]=i=>g.value=i),actions:R.value,"cancel-text":"取消","close-on-click-action":"",onCancel:C,onSelect:te},null,8,["show","actions"])]),_:1},8,["pageLoading"])}}});export{pt as default};
