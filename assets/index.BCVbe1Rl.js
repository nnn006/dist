import{u as E,h as F,a as Q,b as U,c as j,y as q,M as G,N as K,O as I,g as W}from"./index.Cjri3_sP.js";import{_ as X}from"./NewsItem.vue_vue_type_style_index_0_lang.CsWKk6Rr.js";import{d as Y,l as m,m as Z,g as ee,p as se,o as te,e as ae,Q as v,x as oe,r as d,B as l,i as a,S as k}from"./vue.BCHSKM6y.js";const ne={class:"news-main-content hk-pt-104"},le={class:"screen-box hk-flex hk-w-full"},ie={class:"screen-item"},ce={class:"hk-flex hk-items-center"},re={class:"head-select-value"},pe={class:"screen-item"},ue={class:"hk-flex hk-items-center"},de={class:"news-select-value"},fe={class:"screen-item"},me={class:"news-main-box"},ve=a("div",{class:"short-tips-dialog"},[a("div",{class:"pd-dialog-content"},"标记所有消息为已读？")],-1),Se=Y({name:"news",__name:"index",setup(ge){const{t:o}=U(),w=m(null),{hkMessage:S}=W(),{pushName:g}=j(),h=E(),x=m([]),C=m(null),{auth:_}=F(),{pageLoading:R,endPageLoading:L}=Q({activeAction:T}),t=Z({page:1,pageSize:10,total:0,curTime:0,allPayMoney:0,currency:""}),N=ee(()=>[{text:o("base.screen.news.all"),value:0},{text:"未读消息",value:1},{text:o("base.screen.news.pay"),value:2},{text:o("base.screen.news.start"),value:3},{text:o("base.screen.news.end"),value:4},{text:o("base.screen.news.imprest"),value:5}]),y=m([{text:o("base.screen.home.all"),value:0}]),r=m({text:o("base.screen.news.all"),value:0}),i=m({text:o("base.screen.home.all"),value:0}),b=e=>{r.value=e,t.page=1,p()},A=e=>{i.value=e,t.page=1,p()},p=e=>{const f={page:t.page,pageSize:t.pageSize,selectTime:Math.floor(t.curTime/1e3),selectNotifyType:r.value.value,homeId:i.value.value};G(f).then(n=>{if(n.code===0){const c=n.data.list.map(s=>({id:s.notifyId,applicationId:s.applicationId,title:s.title,value:s.typ===3||s.typ===2?s.useCarTime:s.amount,type:s.typ===3||s.typ===2?"time":"price",currencyType:s.currency,pic:s.identifyAvatar,applyState:s.status,active:!s.isRead,homeName:s.homeName,identifyName:s.identifyName,applicationTime:s.notifyTime,identifyId:s.identifyId,duties:s.duties,homeId:s.homeId,endTime:s.endTime,startTime:s.startTime,status:s.status,typ:s.typ}));t.page===1?x.value=c:x.value.push(...c),t.total=n.data.total}else S(n.msg)}).finally(()=>{var n,c;(n=w.value)==null||n.taggleRefreshState("isLoading",!1),(c=w.value)==null||c.taggleRefreshState("loading",!1),e&&e()})},O=e=>{e.active&&K({notifyId:e.id}).then(f=>{f.code===0&&h.updataReadNum(-1)}),window.sessionStorage.setItem("news",JSON.stringify({time:t.curTime,home:i.value,news:r.value})),e.typ===1||e.typ===3?g("PayDetails",{id:e.applicationId}):e.typ===4?g("ImpDetails",{id:e.applicationId}):e.typ===12||e.typ===13?g("StaffDetails",{id:e.identifyId,homeId:e.homeId,newsStatus:e.typ}):g("NewsDetails",{id:e.id,tp:e.typ})},D=()=>{t.page++,p()},P=()=>{t.page=1,p()},M=e=>{t.curTime=new Date(e).getTime(),t.page=1,p()},B=()=>{I().then(e=>{e.code===0?(p(),S("已成功标记所有消息"),C.value.taggleDialog(!1)):S(e.msg)})},H=()=>{I().then(e=>{e.code===0&&(console.log("---clear-news--"),h.clearReadNum())})};async function T(){const e=window.sessionStorage.getItem("news");e?(t.curTime=JSON.parse(e).time,i.value=JSON.parse(e).home,r.value=JSON.parse(e).news,window.sessionStorage.removeItem("news")):(t.curTime=0,_===3||_===4||(i.value={text:o("base.screen.home.all"),value:0}),r.value={text:o("base.screen.news.all"),value:0}),t.page=1,p(L)}return se(async()=>{await h.setHomeSimpleLs();const e=await h.homeSimple;_===3||_===4?(y.value=e,i.value=e[0]):y.value.push(...e),T()}),(e,f)=>{const n=d("SvgIcon"),c=d("HkPopover"),s=d("MonthSelect"),z=d("SecondHeader"),J=d("DownRefresh"),V=d("ConfrimPopAgain"),$=d("MainContainer");return te(),ae($,{exitLoading:!0,pageLoading:oe(R)},{default:v(()=>[l(q,{title:"系统消息",onOnComeBack:H}),a("div",ne,[l(z,null,{default:v(()=>[a("div",le,[a("div",ie,[l(c,{options:y.value,value:i.value.value,pannelClass:"news-minw-168",placement:"bottom-start",offset:[0,18],isSplitBorder:y.value.length>1?[0]:[],isSelectState:!0,onOnChange:f[0]||(f[0]=u=>A(u))},{taggleEle:v(()=>[a("div",ce,[a("span",re,k(i.value.text),1),l(n,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value","isSplitBorder"])]),a("div",pe,[l(c,{options:N.value,value:r.value.value,pannelClass:"news-minw-168",placement:"bottom",offset:[0,18],isSplitBorder:[0],isSelectState:!0,onOnChange:b},{taggleEle:v(()=>[a("div",ue,[a("span",de,k(r.value.text),1),l(n,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value"])]),a("div",fe,[l(s,{isAll:t.curTime===0,value:t.curTime,onOnTimeChange:M},null,8,["isAll","value"])])])]),_:1}),a("div",me,[l(J,{ref_key:"downRefreshRef",ref:w,dataList:x.value,pagination:t,onOnRefresh:P,onOnLoad:D},{default:v(({data:u})=>[l(X,{data:u,valColorClass:u.typ===7||u.typ===6?["val-color-yellow"]:u.typ===5?["val-color-blue"]:[],onClick:he=>O(u)},null,8,["data","valColorClass","onClick"])]),_:1},8,["dataList","pagination"])])]),l(V,{ref_key:"readAllRef",ref:C,popClass:"short-tips-pop",customFooter:!0,onOnConfirm:B},{default:v(()=>[ve]),_:1},512)]),_:1},8,["pageLoading"])}}});export{Se as default};
