import{h as se,u as oe,b as ne,_ as ie,i as le,f as ce,j as re,k as ue,G as de,l as me,m as fe,e as he,n as pe}from"./index.Cjri3_sP.js";import{d as ve,l as c,m as ye,s as _e,p as ge,k as Se,o as r,e as Ie,Q as y,Z as we,_ as ke,r as _,B as i,a5 as De,i as a,S as g,a as u,R as $,H as Q,f as b,x as h}from"./vue.BCHSKM6y.js";import{_ as be}from"./HDetailsOptions.vue_vue_type_style_index_0_lang.CR_H_kKE.js";import{A as Te}from"./index.YYOoEeNT.js";const xe=a("img",{class:"left-arrow-back-img",src:de,alt:"",srcset:""},null,-1),Ne=[xe],Ae=a("span",null,null,-1),Oe={class:"home-details-box hk-pt-noScreen"},He={class:"home-header-info"},Pe={class:"home-pay-class-box"},Ce={class:"hdetails-card-header hdetails-card-p hk-flex hk-jbetween hk-items-center"},Le={class:"hdetails-card-tit"},Me=a("span",{class:"hdetails-card-more"},null,-1),je={class:"home-pay-class-content hk-flex"},Be={key:0,class:"data-empty-fbox"},qe={class:"home-staff-box"},Je=a("div",{class:"hdetails-card-header hdetails-card-p hk-flex hk-jbetween hk-items-center"},[a("span",{class:"hdetails-card-tit"},"员工"),a("span",{class:"hdetails-card-more"})],-1),Ue={class:"home-staff-content"},$e=["onClick"],Qe={class:"home-staff-t hk-flex hk-jbetween"},Ve={class:"home-staff-tl"},Re=["src"],Fe={class:"home-staff-name"},ze={class:"home-staff-tr"},Ee={class:"home-staff-b hk-flex hk-jbetween"},Ge={class:"home-staff-bl"},Ze={class:"hdetails-member-item hk-flex hk-items-center"},Ke={class:"hk-fw-600"},We={key:0,class:"home-staff-br"},Xe={key:0,class:"data-empty-fbox"},ot=ve({name:"homeDetails",__name:"index",setup(Ye){var J;ne();const{auth:T}=se(),S=c(!0),x=()=>{S.value=!1},N=we(),A=ke();let s=(J=A.query)==null?void 0:J.homeId;const I=oe(),O=c(0),H=c(!1),o=c(new Date().getTime()),P=c(),w=c([]),d=ye({list:[],currency:""});let m=null;const p=c(!1),V=c([{name:T===3?"划拨备用金":"发放备用金",value:5},{name:"收回备用金",value:7},{name:"员工备用金详情",value:"StatisticDetails"}]),C=e=>{P.value={title:e.data.nickname,pic:e.data.avatar,currency:e.data.currency,id:e.data.homeId,statistic:[{label:"homeItem.payMoney",value:e.data.payMoney,type:"price",haveInfoArrow:!0,routeName:"StatisticDetails",otherQuery:{homeId:s,qtime:o.value,pageTp:1,fee:0},setSession:{time:o.value}},{label:"homeItem.carTime",value:e.data.useCarTime,type:"time",haveInfoArrow:!0,routeName:"StatisticDetails",otherQuery:{homeId:s,qtime:o.value,pageTp:3,fee:0},setSession:{time:o.value}},{label:"homeItem.preImprest",value:e.data.amount,type:"number",haveInfoArrow:!0,routeName:"StatisticDetails",otherQuery:{homeId:s,qtime:o.value,pageTp:2,fee:0},setSession:{time:o.value}},{label:"homeItem.staffNum",value:e.data.employeesNum,type:"people",haveInfoArrow:!0,routeName:"StaffManage",otherQuery:{homeId:s}}]}},R=()=>new Promise(e=>{me({homeId:s,selectTime:Math.floor(o.value/1e3)}).then(t=>{t.code===0&&C(t)}).finally(()=>{e(!0)})}),L=e=>{d.currency=e.currency,d.list=e.list.map(t=>({type:"number",label:t.expenseType,value:t.payMoney,expenseTypeId:t.expenseTypeId}))},F=()=>new Promise(e=>{fe({homeId:s,selectTime:Math.floor(o.value/1e3),selectTimeTyp:2}).then(t=>{t.code===0&&L(t.data)}).finally(()=>{e(!0)})}),M=e=>{w.value=e.list.map(t=>({picture:he+t.avatar,name:t.nickname,id:t.identifyId,amount:t.amount,identifyType:t.identifyType,currency:t.currency,jop:{label:"homeItem.jop",value:t.duties,type:"text"},residueImprest:{value:"",type:"price",label:"homeItem.residueImprest"},doTask:{value:t.useCarTime,type:"time",label:"homeItem.carTime"}}))},z=()=>new Promise(e=>{pe({page:1,pageSize:999,homeId:s,selectTime:Math.floor(o.value/1e3)}).then(t=>{t.code===0&&M(t.data)}).finally(()=>{e(!0)})}),j=()=>{const e=window.sessionStorage.getItem("homeDetailsData");if(e){const t=JSON.parse(e);C({data:t.homeStatisticsInfo}),L(t.payStatisticsInfo),M(t.staffStatisticsList),window.sessionStorage.removeItem("homeDetailsData"),x()}else Promise.all([R(),F(),z()]).then(()=>{x()});(I.userInfo.identifyType===1||I.userInfo.identifyType===2)&&E()},E=()=>{ue({homeId:s}).then(e=>{e.code===0&&(O.value=e.data.untreatedNum)})},G=e=>{o.value=new Date(e).getTime(),j()},Z=()=>{N.go(-1)},l=(e,t)=>{const f={name:e};t&&(f.query=t),N.push(f)},K=()=>{l("Pay",{homeId:s,currency:d.currency})},W=e=>{window.sessionStorage.setItem("toStatic",JSON.stringify({time:o.value})),l("StatisticDetails",{homeId:s,qtime:o.value,pageTp:1,fee:e.expenseTypeId})},X=()=>{l("DataReview",{homeId:s})},Y=e=>{m=e,p.value=!0},ee=(e,t,f)=>{window.sessionStorage.setItem("toStatic",JSON.stringify({time:o.value})),window.sessionStorage.setItem("statisticDetails",JSON.stringify({staff:{text:f,value:t}})),l("StatisticDetails",{homeId:s,pageTp:e,qtime:o.value,fee:0})},B=()=>{p.value=!1,m=null},te=e=>{e.value==="StatisticDetails"?(window.sessionStorage.setItem("toStatic",JSON.stringify({time:o.value})),l("StatisticDetails",{homeId:s,pageTp:2,fee:0,qtime:o.value,stfId:m.id})):l("ImpOperation",{homeId:s,id:m.id,currency:m.currency,doType:e.value}),B()},q=async()=>{const e=window.sessionStorage.getItem("toStatic");e&&(o.value=JSON.parse(e).time,window.sessionStorage.removeItem("toStatic")),j();const t=await I.getUseInfoHomeNum;H.value=t>1};return _e(()=>{var t;const e=(t=A.query)==null?void 0:t.homeId;s!==e&&(S.value=!0),s=e,q()}),ge(async()=>{q()}),Se(()=>{m=null}),(e,t)=>{const f=_("SecondHeader"),v=_("DataInfoItem"),U=_("hk-empty"),ae=_("MainContainer");return r(),Ie(ae,{exitLoading:!0,pageLoading:S.value},{default:y(()=>[i(ie,{class:"home-details-header",onOnSelectTime:G,timeValue:o.value},De({title:y(()=>[Ae]),_:2},[H.value?{name:"comeback",fn:y(()=>[a("div",{class:"left-arrow-box",onClick:Z},Ne)]),key:"0"}:void 0]),1032,["timeValue"]),i(f,{noScreen:!0}),a("div",Oe,[a("div",He,[i(le,{data:P.value,haveInfoArrow:!1},null,8,["data"])]),i(be,{onOnFirBtnHandle:t[0]||(t[0]=()=>K()),onOnSecBtnHandle:t[1]||(t[1]=()=>X()),contentNumber:O.value},null,8,["contentNumber"]),a("div",Pe,[a("div",Ce,[a("span",Le,"支出分类("+g(d.currency)+")",1),Me]),a("div",je,[(r(!0),u(Q,null,$(d.list,(n,k)=>(r(),u("div",{class:"pay-class-item",key:k},[i(v,{valData:n,haveArrow:!0,onOnHandle:W},null,8,["valData"])]))),128)),d.list.length===0?(r(),u("div",Be,[i(U)])):b("",!0)])]),a("div",qe,[Je,a("div",Ue,[(r(!0),u(Q,null,$(w.value,(n,k)=>(r(),u("div",{class:"home-staff-item",key:k,onClick:D=>l("StaffDetails",{id:n.id,homeId:h(s)})},[a("div",Qe,[a("div",Ve,[a("img",{class:"home-staff-img",src:n.picture,alt:""},null,8,Re),a("div",Fe,g(h(ce)(n.name,6)),1)]),a("div",ze,[i(v,{valData:n.jop,haveArrow:!0,onOnHandle:D=>l("StaffDetails",{id:n.id,homeId:h(s)})},null,8,["valData","onOnHandle"])])]),a("div",Ee,[a("div",Ge,[i(v,{haveArrow:!0,valData:n.residueImprest,onOnHandle:D=>Y({id:n.id,currency:n.currency})},{default:y(()=>[a("div",Ze,[a("span",Ke,g(h(re)(n.amount)),1),a("span",null,g(n.currency),1)])]),_:2},1032,["valData","onOnHandle"])]),n.identifyType!==3?(r(),u("div",We,[i(v,{valData:n.doTask,haveArrow:!0,onOnHandle:D=>ee(3,n.id,n.name)},null,8,["valData","onOnHandle"])])):b("",!0)])],8,$e))),128)),w.value.length===0?(r(),u("div",Xe,[i(U)])):b("",!0)])])]),i(h(Te),{class:"hk-action-sheet",show:p.value,"onUpdate:show":t[2]||(t[2]=n=>p.value=n),actions:V.value,"cancel-text":"取消","close-on-click-action":"",onCancel:B,onSelect:te},null,8,["show","actions"])]),_:1},8,["pageLoading"])}}});export{ot as default};
