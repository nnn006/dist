import{h as M,a as P,u as B,b as A,y as z,Q as J}from"./index.Cjri3_sP.js";import{d as V,l as f,m as $,p as E,o as Q,e as j,Q as u,x as S,Z as q,r,B as n,i,S as U}from"./vue.BCHSKM6y.js";import{_ as Z}from"./NewsItem.vue_vue_type_style_index_0_lang.CsWKk6Rr.js";import{c as F}from"./index.DllRNd8O.js";const G={class:"imp-main-content hk-pt-104"},K={class:"screen-box hk-flex hk-w-full"},W={class:"screen-item"},X={class:"screen-item"},Y={class:"hk-flex hk-items-center"},ee={class:"head-select-value"},te={class:"imp-main-box"},ae=["src"],re=V({name:"Imprest",__name:"index",setup(se){const{t:d}=A(),{auth:w}=M(),L=q(),{pageLoading:T,endPageLoading:x}=P({activeAction:y}),h=f(null),_=f([]),v=B(),g=f([{text:d("base.screen.home.all"),value:0}]),l=f({text:d("base.screen.home.all"),value:0}),e=$({page:1,pageSize:10,total:0,curTime:0}),k=t=>{window.sessionStorage.setItem("imprest",JSON.stringify({time:e.curTime,home:l.value})),L.push({name:"ImpDetails",query:{id:t.id}})},N=t=>{l.value=t,e.page=1,m()},m=t=>{const s={page:e.page,pageSize:e.pageSize,selectTime:Math.floor(e.curTime/1e3),selectTimeTyp:2,homeId:l.value.value};F(s).then(o=>{if(o.code===0){const c=o.data.list.map(a=>({id:a.applicationId,title:a.title,value:a.amount,type:"price",currencyType:a.currency,pic:a.identifyAvatar,applyState:a.status,active:!1,homeName:a.homeName,identifyName:a.identifyName,applicationTime:a.applicationTime,typ:a.typ}));e.page===1?_.value=c:_.value.push(...c),e.total=o.data.total}}).finally(()=>{var o,c;(o=h.value)==null||o.taggleRefreshState("isLoading",!1),(c=h.value)==null||c.taggleRefreshState("loading",!1),t&&t()})},C=()=>{e.page++,m()},I=()=>{v.putNotifyNum(),e.page=1,m()},H=t=>{e.curTime=new Date(t).getTime(),e.page=1,m()};async function y(){await v.setHomeSimpleLs();const t=await v.homeSimple;w===3?(g.value=t,l.value=t[0]):g.value=[{text:d("base.screen.home.all"),value:0},...t];const s=window.sessionStorage.getItem("imprest");s&&(e.curTime=JSON.parse(s).time,l.value=JSON.parse(s).home,window.sessionStorage.removeItem("imprest")),e.page=1,m(x)}return E(async()=>{y()}),(t,s)=>{const o=r("MonthSelect"),c=r("SvgIcon"),a=r("HkPopover"),R=r("SecondHeader"),O=r("DownRefresh"),b=r("HkNoHome"),D=r("MainContainer");return Q(),j(D,{exitLoading:!0,pageLoading:S(T)},{default:u(()=>[n(z,{haveLiftEle:!1,title:S(d)("base.header.applyList")},null,8,["title"]),i("div",G,[n(R,null,{default:u(()=>[i("div",K,[i("div",W,[n(o,{isAll:e.curTime===0,value:e.curTime,onOnTimeChange:H},null,8,["isAll","value"])]),i("div",X,[n(a,{options:g.value,value:l.value.value,pannelClass:"imp-minw-168",placement:"bottom-end",offset:[0,18],isSplitBorder:g.value.length>1?[0]:[],isSelectState:!0,onOnChange:s[0]||(s[0]=p=>N(p))},{taggleEle:u(()=>[i("div",Y,[i("span",ee,U(l.value.text),1),n(c,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value","isSplitBorder"])])])]),_:1}),i("div",te,[n(O,{ref_key:"downRefreshRef",ref:h,dataList:_.value,pagination:e,onOnRefresh:I,onOnLoad:C},{default:u(({data:p})=>[n(Z,{data:p,onClick:oe=>k(p)},{examineState:u(()=>[i("img",{class:"msg-state-img",src:S(J)(p.applyState===1?"wait":p.applyState===2?"pass":"reject"),alt:"",srcset:""},null,8,ae)]),_:2},1032,["data","onClick"])]),_:1},8,["dataList","pagination"])])]),n(b)]),_:1},8,["pageLoading"])}}});export{re as default};
