import{d as H,c as z,f as B,Q as V,u as J,ad as $,ac as U,a as j,b as E}from"./index.C__3lhMr.js";import{_ as F}from"./NewsItem.vue_vue_type_style_index_0_lang.C3OnuWsN.js";import{l as K,r as u,b as Q,a as W,d as q,K as c,L as G,U as X,V as o,k as i,N as n,O as Y,u as S}from"./vue.C2TeXnf4.js";const Z={class:"news-main-content sf-news-main"},ee={class:"screen-box hk-flex hk-w-full"},ae={class:"screen-item"},se={class:"hk-flex hk-items-center"},te={class:"news-select-value"},ne={class:"screen-item"},oe={class:"news-main-content sf-news-main hk-pt-104"},ie={class:"news-main-box"},le=["src"],ce=n("div",{class:"short-tips-dialog"},[n("div",{class:"pd-dialog-content"},"标记所有消息为已读？")],-1),ge=K({__name:"news",setup(re){const{t:p}=J(),f=u(null),{hkMessage:g}=j(),{pushName:T}=H(),m=u([]),h=u(null),a=Q({page:1,pageSize:10,total:0,curTime:0,allPayMoney:0,currency:""}),L=W(()=>[{text:p("base.screen.news.all"),value:0},{text:p("base.screen.news.pay"),value:1},{text:p("base.screen.news.end"),value:3}]),r=u({text:p("base.screen.news.all"),value:0}),{pageLoading:k,endPageLoading:C}=z({}),{showLoading:w,closeLoading:y}=E(),x=s=>{r.value=s,a.page=1,w(),d(y)},d=s=>{const _={page:a.page,pageSize:a.pageSize,selectTime:Math.floor(a.curTime/1e3),selectNotifyType:r.value.value};$(_).then(t=>{if(t.code===0){const l=t.data.list.map(e=>({id:e.applicationId,title:e.title,value:e.typ===3?e.useCarTime:e.amount,type:e.typ===1?"price":e.typ===3?"time":"text",currencyType:e.currency,pic:e.identifyAvatar,applyState:e.status,active:!1,homeName:e.homeName,identifyName:e.identifyName,applicationTime:e.applicationTime,status:e.status,endTime:e.endTime,startTime:e.startTime,typ:e.typ}));_.page===1?m.value=l:m.value.push(...l),a.total=t.data.total,a.allPayMoney=t.data.allPayMoney,a.currency=t.data.currency}else g(t.msg)}).finally(()=>{var t,l;(t=f.value)==null||t.taggleRefreshState("isLoading",!1),(l=f.value)==null||l.taggleRefreshState("loading",!1),s&&s()})},R=s=>{window.sessionStorage.setItem("news",JSON.stringify({time:a.curTime,news:r.value})),T("PayStfDetails",{id:s.id})},N=()=>{a.page++,d()},P=()=>{a.page=1,d()},A=s=>{a.curTime=new Date(s).getTime(),a.page=1,w(),d(y)},M=()=>{U().then(s=>{s.code===0?(d(),g("已成功标记所有消息"),h.value.taggleDialog(!1)):g(s.msg)})};return q(()=>{const s=window.sessionStorage.getItem("news");s&&(a.curTime=JSON.parse(s).time,r.value=JSON.parse(s).news,window.sessionStorage.removeItem("news")),d(C)}),(s,_)=>{const t=c("SvgIcon"),l=c("HkPopover"),e=c("MonthSelect"),O=c("SecondHeader"),b=c("DownRefresh"),D=c("ConfrimPopAgain"),I=c("MainContainer");return G(),X(I,{exitLoading:!0,pageLoading:S(k)},{header:o(()=>[i(B,{title:"消息"})]),headerScreen:o(()=>[n("div",Z,[i(O,null,{default:o(()=>[n("div",ee,[n("div",ae,[i(l,{options:L.value,value:r.value.value,pannelClass:"news-minw-168",placement:"bottom-start",offset:[0,18],isSplitBorder:[0],isSelectState:!0,onOnChange:x},{taggleEle:o(()=>[n("div",se,[n("span",te,Y(r.value.text),1),i(t,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value"])]),n("div",ne,[i(e,{isAll:a.curTime===0,value:a.curTime,onOnTimeChange:A},null,8,["isAll","value"])])])]),_:1})])]),default:o(()=>[n("div",oe,[n("div",ie,[i(b,{ref_key:"downRefreshRef",ref:f,dataList:m.value,pagination:a,onOnRefresh:P,onOnLoad:N},{default:o(({data:v})=>[i(F,{data:v,onClick:de=>R(v)},{examineState:o(()=>[n("img",{class:"msg-state-img",src:S(V)(v.status===3?"stfReject":"stfWaitUpd"),alt:"",srcset:""},null,8,le)]),_:2},1032,["data","onClick"])]),_:1},8,["dataList","pagination"])])]),i(D,{ref_key:"readAllRef",ref:h,popClass:"short-tips-pop",customFooter:!0,onOnConfirm:M},{default:o(()=>[ce]),_:1},512)]),_:1},8,["pageLoading"])}}});export{ge as default};
