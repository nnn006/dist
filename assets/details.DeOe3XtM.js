import{b as Y,c as Z,f as k,F as ee,g as ae}from"./index.Cjri3_sP.js";import{_ as te}from"./TabHeader.vue_vue_type_style_index_0_lang.CUFJY219.js";import{d as se,l as d,m as oe,s as ie,p as le,o as R,e as ne,Q as v,x as t,_ as re,r as g,B as c,i as r,S as _,n as ce,a as ue,f as me,a5 as fe,L as M}from"./vue.BCHSKM6y.js";import{_ as pe}from"./StatisticTotal.vue_vue_type_style_index_0_lang.BmZUdypW.js";import{_ as ve}from"./NewsItem.vue_vue_type_style_index_0_lang.CsWKk6Rr.js";import{s as de,a as ge,b as ye}from"./index.XGvY1KZZ.js";import{u as he}from"./useConfigBaseInfo.D5J8WFky.js";const _e={class:"stic-details-box"},be={class:"screen-box hk-flex hk-jbetween hk-w-full"},Te={class:"screen-item"},Se={class:"screen-item"},Ce={class:"item-mr-24"},Ne={class:"hk-flex hk-items-center"},ke={class:"head-select-value"},we={class:"head-select-value"},De={key:0},Oe={class:"head-select-value"},Pe={class:"statistic-total-desc"},qe={class:"stic-details-list sticp-details-list"},He=se({name:"StatisticDetails",__name:"details",setup(xe){const{t:V}=Y(),{pushName:b}=Z(),{hkMessage:I}=ae(),u=re(),e=d(u.query.pageTp),w=d(null),D=d(null),T=d([]),S=d(null),C=d(null),a=oe({page:1,pageSize:10,total:0,curTime:new Date().getTime(),allPayMoney:0,currency:""}),N=(i,s)=>{o[s]=i,s==="home"&&(o.staff={text:V("base.screen.allStaff"),value:0},e.value==="1"?E():J()),a.page=1,y()},y=()=>new Promise(i=>{const s={page:a.page,pageSize:a.pageSize,homeId:o.home.value,selectTime:Math.floor(a.curTime/1e3),selectTimeTyp:m.value,identifyId:e.value==="1"?o.member.value:o.staff.value};Number(e.value)===1&&(s.expenseTypeId=o.type.value),(Number(e.value)===1?de:Number(e.value)===2?ge:ye)(s).then(n=>{if(n.code===0){const p=n.data.list.map(l=>({id:l.id,title:l.title,value:Number(e.value)===3?l.useCarTime:Number(e.value)===2?l.amount:l.payMoney,type:Number(e.value)===3?"time":"price",currencyType:l.currency,pic:l.identifyAvatar,applyState:l.status,active:!1,homeName:l.homeName,identifyName:l.identifyName,applicationTime:l.applicationTime,status:l.status,useCarTime:l.useCarTime,endTime:l.endTime,startTime:l.startTime,typ:l.typ}));a.page===1?T.value=p:T.value.push(...p),a.total=n.data.total,a.allPayMoney=Number(e.value)===3?n.data.allUseCarTime:Number(e.value)===2?n.data.allAmount:n.data.allPayMoney,a.currency=n.data.currency,C.value=n.data.overtimeUseCarTime}else I(n.msg)}).finally(()=>{var n,p;(n=S.value)==null||n.taggleRefreshState("isLoading",!1),(p=S.value)==null||p.taggleRefreshState("loading",!1),i(!0)})}),{homeSelectData:B,hTabData:z,feeOption:A,screenVal:o,curValue:m,carTabData:H,imprestTabData:$,staffOption:O,getMemberList:E,getStaffList:J,memberOption:P,pageLoading:q}=he({loadList:async()=>{a.page=1,await y()},type:e.value}),j=i=>{window.sessionStorage.setItem("statisticDetails",JSON.stringify({staff:e.value==="1"?o.member:o.staff,fee:o.type,home:o.home,time:a.curTime,tabVal:m.value})),Number(e.value)===1||Number(e.value)===3?b("PayDetails",{id:i.id}):Number(e.value)===2&&b("NewsDetails",{id:i.id,tp:i.typ,pgTp:1})},x=()=>{window.sessionStorage.setItem("statisticDetails",JSON.stringify({staff:o.staff,home:o.home,time:a.curTime,tabVal:m.value})),b("WorkOvertime")},F=i=>{m.value=i,L()},U=()=>{a.page++,y()},L=()=>{a.page=1,y()},W=i=>{a.curTime=new Date(i).getTime(),a.page=1,y()},Q=()=>{w.value.visiblePopover()},G=()=>{D.value.visiblePopover()};return ie(()=>{u.query.qtime&&(a.curTime=Number(u.query.qtime)),u.query.qtab&&(m.value=Number(u.query.qtab));const i=u.query.pageTp;i!==e.value&&(e.value=i,q.value=!0);const s=window.sessionStorage.getItem("statisticDetails");if(s){const h=JSON.parse(s);h.tabVal&&(m.value=h.tabVal)}e.value=u.query.pageTp}),le(()=>{u.query.qtime&&(a.curTime=Number(u.query.qtime)),u.query.qtab&&(m.value=Number(u.query.qtab));const i=window.sessionStorage.getItem("statisticDetails");if(i){const s=JSON.parse(i);s.time&&(a.curTime=s.time),s.tabVal&&(m.value=s.tabVal)}}),(i,s)=>{const h=g("MonthSelect"),n=g("SvgIcon"),p=g("HkPopover"),l=g("SecondHeader"),K=g("DownRefresh"),X=g("MainContainer");return R(),ne(X,{exitLoading:!0,pageLoading:t(q)},{default:v(()=>[c(te,{curValue:t(m),tabConetnt:e.value==="3"?t(H):e.value==="2"?t($):t(z),onOnChange:F},null,8,["curValue","tabConetnt"]),r("div",_e,[c(l,null,{default:v(()=>[r("div",be,[r("div",Te,[c(h,{onOnTimeChange:W,value:a.curTime,dateType:t(m)},null,8,["value","dateType"])]),r("div",Se,[r("div",Ce,[c(p,{options:t(B),value:t(o).home.value,pannelClass:"stic-minw-140",placement:"bottom-end",offset:[0,18],isSelectState:!0,onOnChange:s[0]||(s[0]=f=>N(f,"home"))},{taggleEle:v(()=>[r("div",Ne,[r("span",ke,_(t(k)(t(o).home.text)),1),c(n,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value"])]),r("div",{class:ce({"item-mr-24":e.value==="1"})},[c(p,{ref_key:"staffPopoverRef",ref:D,trigger:"manual",options:e.value==="1"?t(P):t(O),value:t(o)[e.value==="1"?"member":"staff"].value,pannelClass:"stic-minw-140",placement:"bottom-end",offset:[0,18],isSplitBorder:e.value==="1"?t(P).length<=1?[]:[0]:t(O).length<=1?[]:[0],isSelectState:!0,noDataTips:`暂无${e.value==="1"?"人员":"员工"}`,onOnChange:s[1]||(s[1]=f=>N(f,e.value==="1"?"member":"staff"))},{taggleEle:v(()=>[r("div",{class:"hk-flex hk-items-center",onClick:G},[r("span",we,_(t(k)(t(o)[e.value==="1"?"member":"staff"].text)),1),c(n,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value","isSplitBorder","noDataTips"])],2),e.value==="1"?(R(),ue("div",De,[c(p,{ref_key:"feePopoverRef",ref:w,options:t(A),trigger:"manual",value:t(o).type.value,pannelClass:"stic-minw-140",placement:"bottom-end",offset:[0,18],isSplitBorder:[0],isSelectState:!0,noDataTips:"暂无费用类型",onOnChange:s[2]||(s[2]=f=>N(f,"type"))},{taggleEle:v(()=>[r("div",{class:"hk-flex hk-items-center",onClick:Q},[r("span",Oe,_(t(k)(t(o).type.text)),1),c(n,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value"])])):me("",!0)])])]),_:1}),c(pe,{total:a.total,type:Number(e.value)===1?"number":Number(e.value)===2?"imprest":"time",value:a.allPayMoney,currency:a.currency,onOnDescHandle:x},fe({_:2},[C.value&&t(m)===2?{name:"desc",fn:v(()=>[r("span",Pe,[M("(加班："),r("span",{onClick:x},_(t(ee)(C.value)),1),M(" >)")])]),key:"0"}:void 0]),1032,["total","type","value","currency"]),r("div",qe,[c(K,{ref_key:"downRefreshRef",ref:S,dataList:T.value,pagination:a,onOnRefresh:L,onOnLoad:U},{default:v(({data:f})=>[c(ve,{data:f,valColorClass:f.typ===7||f.typ===6?["val-color-yellow"]:f.typ===5?["val-color-blue"]:[],onClick:Le=>j(f)},null,8,["data","valColorClass","onClick"])]),_:1},8,["dataList","pagination"])])])]),_:1},8,["pageLoading"])}}});export{He as default};
