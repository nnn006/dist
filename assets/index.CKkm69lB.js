import{d as $,c as q,q as z,j as G,f as K,aB as W,u as X,aP as Y,aQ as Z,aG as ee,a as ae,b as se,aR as te,aI as oe}from"./index.C__3lhMr.js";import{_ as ne}from"./manageItem.vue_vue_type_style_index_0_lang.CROEXGMz.js";import{l as le,r as i,d as ce,K as u,L as p,U as M,V as d,k as r,u as I,N as t,O as N,M as O,Q as ie,F as re,S as ue,D,n as de}from"./vue.C2TeXnf4.js";const ge={class:"staff-manage-box"},me={class:"screen-box hk-flex hk-w-full"},ve={class:"screen-item"},pe={class:"hk-flex hk-items-center"},fe={class:"sm-select-value"},_e=t("img",{class:"drap-icon",src:oe,alt:""},null,-1),he={class:"tips-details-dialog"},Se={class:"tips-dialog-content"},Ce=t("br",null,null,-1),ye=le({__name:"index",setup(ke){const{t:w}=X(),f=i(null),{pushName:L}=$(),{hkMessage:g}=ae(),{pageLoading:A,endPageLoading:B}=q({}),{showLoading:H,closeLoading:R}=se(),V=z(),x=G(),_=i(!1),o=i([]),v=i(null),y=i(null),P=i([{text:w("base.screen.home.all"),value:0}]),s=i({}),J=e=>{s.value=e,H(),h(R)},T=e=>{var a;v.value=e,(a=f.value)==null||a.taggleDialog(!0)},b=()=>{v.value=null},j=()=>{Y({id:v.value.value}).then(e=>{var a;e.code===0?((a=f.value)==null||a.taggleDialog(!1),g("删除成功"),h(),b(),V.setCostType(s.value.value)):g(e.msg)}).catch(e=>{g(e)})},E=e=>{L("CostAdd",{title:e.label,id:e.value,homeId:s.value.value}),window.sessionStorage.setItem("costManage",JSON.stringify(s.value))},F=()=>{L("CostAdd",{homeId:s.value.value}),window.sessionStorage.setItem("costManage",JSON.stringify(s.value))},h=e=>{_.value=!0,Z({homeId:s.value.value}).then(a=>{if(a.code===0){const n=a.data.list.map(c=>({label:c.title,value:c.id}));o.value=n,e&&e()}else g(a.msg)}).finally(()=>{_.value=!1})},U=(e,a,n)=>{te({tranId:o.value[n].value,index:a+1}).then(c=>{if(c.code===0){const m=JSON.parse(JSON.stringify(o.value)),S=m.splice(n,1)[0],C=m.slice(0,n),k=m.slice(n),l=[...C,...k];l.splice(a,0,S),o.value=l}else g(c.msg)})};async function Q(){await x.setHomeSimpleLs();const e=await x.homeSimple;P.value=e,s.value=e[0];const a=window.sessionStorage.getItem("costManage");a&&(s.value=JSON.parse(a),window.sessionStorage.removeItem("costManage"))}return ce(async()=>{await Q(),h(()=>{ee(y.value,o.value,{handle:".drap-icon",onUpdate:e=>{U(o.value,e.newIndex,e.oldIndex),de(()=>{})}}),B()})}),(e,a)=>{const n=u("SvgIcon"),c=u("HkPopover"),m=u("SecondHeader"),S=u("hk-empty"),C=u("ConfrimPopAgain"),k=u("MainContainer");return p(),M(k,{exitLoading:!0,pageLoading:I(A)},{header:d(()=>[r(K,{title:I(w)("base.header.costManage")},null,8,["title"]),t("div",ge,[r(m,{headerBtmW:!0},{default:d(()=>[t("div",me,[t("div",ve,[r(c,{options:P.value,value:s.value.value,pannelClass:"saf-manage-minw-168",placement:"bottom-start",offset:[0,18],isSplitBorder:[],isSelectState:!0,onOnChange:J},{taggleEle:d(()=>[t("div",pe,[t("span",fe,N(s.value.text),1),r(n,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value"])])])]),_:1})])]),default:d(()=>[t("div",{ref_key:"jobManageItemRef",ref:y,class:"cost-manage-box hk-pt-104 container-setPx"},[(p(!0),O(re,null,ie(o.value,l=>(p(),O("div",{class:"cost-manage-item",key:l.value},[r(ne,{type:1,data:l,onOnClose:T,onOnDetails:E},{default:d(()=>[_e]),_:2},1032,["data"])]))),128))],512),r(W,{onClick:F}),!o.value.length&&!_.value?(p(),M(S,{key:0})):ue("",!0),r(C,{ref_key:"confirmPopRef",ref:f,popClass:"tips-dialog-box",customFooter:!0,onOnCancel:b,onOnConfirm:j},{default:d(()=>{var l;return[t("div",he,[t("div",Se,[D("确定删除“"+N((l=v.value)==null?void 0:l.label)+"”",1),Ce,D("费用种类？")])])]}),_:1},512)]),_:1},8,["pageLoading"])}}});export{ye as default};
