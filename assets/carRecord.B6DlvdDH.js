import{u as N,b as O,c as V,F as P,g as B}from"./index.Cjri3_sP.js";import{_ as U}from"./TabHeader.vue_vue_type_style_index_0_lang.CUFJY219.js";import{d as $,l as m,m as z,p as H,o as J,e as W,Q as p,x as c,_ as j,r as f,B as r,i as l,a5 as A,L as S,S as F}from"./vue.BCHSKM6y.js";import{_ as q}from"./StatisticTotal.vue_vue_type_style_index_0_lang.BmZUdypW.js";import{_ as Q}from"./NewsItem.vue_vue_type_style_index_0_lang.CsWKk6Rr.js";import{b as E}from"./index.XGvY1KZZ.js";import{u as G}from"./useConfigBaseInfo.D5J8WFky.js";const K={class:"stic-details-box"},X={class:"screen-box hk-flex hk-jbetween hk-w-full"},Y={class:"screen-item"},Z={class:"statistic-total-desc"},ee={class:"stic-details-list sticp-details-list"},ue=$({__name:"carRecord",setup(ae){O();const{hkMessage:C}=B(),{pushName:h}=V(),w=j();m(w.query.pageTp);const u=N(),g=m([]),_=m(null),y=m(null),e=z({page:1,pageSize:10,total:0,curTime:new Date().getTime(),allPayMoney:0,currency:""}),d=()=>new Promise(s=>{const n={page:e.page,pageSize:e.pageSize,homeId:u.userInfo.homeId,selectTime:Math.floor(e.curTime/1e3),selectTimeTyp:o.value,identifyId:u.userInfo.identifyId,expenseTypeId:0};E(n).then(t=>{if(t.code===0){const i=t.data.list.map(a=>({id:a.id,title:a.title,value:a.useCarTime,type:"time",currencyType:a.currency,pic:a.identifyAvatar,applyState:a.status,active:!1,homeName:a.homeName,identifyName:a.identifyName,applicationTime:a.applicationTime,endTime:a.endTime,startTime:a.startTime,typ:a.typ,status:a.status}));e.page===1?g.value=i:g.value.push(...i),e.total=t.data.total,e.allPayMoney=t.data.allUseCarTime,e.currency=t.data.currency,y.value=t.data.overtimeUseCarTime}else C(t.msg)}).finally(()=>{var t,i;(t=_.value)==null||t.taggleRefreshState("isLoading",!1),(i=_.value)==null||i.taggleRefreshState("loading",!1),s(!0)})}),v=()=>{e.page=1,d()},{carTabData:I,curValue:o,pageLoading:b}=G({loadList:async()=>{e.page=1,await d()}}),k=()=>{window.sessionStorage.setItem("statisticDetails",JSON.stringify({staff:{text:"",value:u.userInfo.identifyId},home:{text:"",value:u.userInfo.homeId},time:e.curTime,tabVal:o.value})),h("WorkOvertime")},D=s=>{window.sessionStorage.setItem("statisticDetails",JSON.stringify({time:e.curTime,tabVal:o.value})),h("UseCarDeatils",{id:s.id})},L=s=>{o.value=s,v()},x=()=>{e.page++,d()},R=s=>{e.curTime=new Date(s).getTime(),e.page=1,d()};return H(()=>{const s=window.sessionStorage.getItem("statisticDetails");if(s){const n=JSON.parse(s);n.time&&(e.curTime=n.time),n.tabVal&&(o.value=n.tabVal)}}),(s,n)=>{const t=f("MonthSelect"),i=f("SecondHeader"),a=f("DownRefresh"),M=f("MainContainer");return J(),W(M,{exitLoading:!0,pageLoading:c(b)},{default:p(()=>[r(U,{curValue:c(o),tabConetnt:c(I),onOnChange:L},null,8,["curValue","tabConetnt"]),l("div",K,[r(i,null,{default:p(()=>[l("div",X,[l("div",Y,[r(t,{onOnTimeChange:R,value:e.curTime,dateType:c(o)},null,8,["value","dateType"])])])]),_:1}),r(q,{total:e.total,type:"time",value:e.allPayMoney,currency:e.currency},A({_:2},[y.value&&c(o)===2?{name:"desc",fn:p(()=>[l("span",Z,[S("(加班："),l("span",{onClick:k},F(c(P)(y.value)),1),S(" >)")])]),key:"0"}:void 0]),1032,["total","value","currency"]),l("div",ee,[r(a,{ref_key:"downRefreshRef",ref:_,dataList:g.value,pagination:e,onOnRefresh:v,onOnLoad:x},{default:p(({data:T})=>[r(Q,{data:T,onClick:te=>D(T)},null,8,["data","onClick"])]),_:1},8,["dataList","pagination"])])])]),_:1},8,["pageLoading"])}}});export{ue as default};
