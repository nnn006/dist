import{d as de,l as m,g as M,p as pe,o as n,e as b,Q as g,x as e,_ as me,r as f,B as i,a as r,f as d,i as l,S as u,a6 as O,H as x,L as U,R as fe}from"./vue.BCHSKM6y.js";import{I as ge,u as ve,a3 as _e,a as ye,c as he,b as be,Q as xe,y as Te,t as F,j as ke,a6 as Ie,a4 as Re,g as we}from"./index.Cjri3_sP.js";import{_}from"./BaseInfoItem.vue_vue_type_style_index_0_lang.DMYgpoJW.js";import{a as Ce,u as De}from"./index.DllRNd8O.js";import{u as Se}from"./usePayDetails.DH5-JNNp.js";import"./right-arrow-icon.CaFxgYzl.js";const Be=["src"],He={class:"pay-details-box updata-staff-box container-setPx"},Ve={key:0,class:"hk-flex hk-items-center"},Ae={class:"form-item-price-util"},Pe={key:1,class:"pydtl-val-item",style:{"font-weight":"500"}},Le={class:"pydtl-val-item"},$e={key:1,class:"pydtl-info-item"},Me={class:"pydtl-info-title"},Oe={class:"pydtl-info-desc"},Ue={key:1,class:"form-textarea-box"},Fe={class:"hk-flex hk-jbetween hk-items-center form-textarea-t"},Ne={class:"form-textarea-tl"},qe={class:"form-textarea-tr"},Ye={class:"form-textarea-b"},je={class:"mpicture-info-item"},Ee=l("div",{class:"mpicture-info-title"},"照片",-1),Qe={class:"mpicture-info-img hk-flex"},ze=["src","onClick"],Ge={key:1,class:"form-upload-img-box"},Je={class:"form-upload-img-tit"},Ke=l("span",null,"*",-1),We={key:0,class:"form-upload-img"},Xe={key:2,class:"footer-aux-btmbox"},Ze={key:3,class:"footer-btn-box"},et={key:4,class:"footer-btn-box"},tt=l("div",{class:"staff-edit-dialog"},[l("div",{class:"pd-dialog-content"},"确定删除该条记录")],-1),dt=de({__name:"staffRecord",setup(at){const{comeback:N}=he(),q=me(),T=ge.inApp(),{id:k}=q.query,{hkMessage:v}=we(),I=ve(),Y=_e(),R=m([]),w=m(!1),{applyInfo:t,getApplyDetails:C,fileList:D,baseImgUrl:st}=Se(),o=m(!1),S=m(null),B=m(null),y=m(null),H=m(!0),h=m(null),V=m(null),{t:c}=be(),{pageLoading:j,endPageLoading:E}=ye({}),A=s=>{B.value.taggleVisible()},Q=M(()=>!!t.price.value&&H.value),z=M(()=>o.value?!0:!!t.desc),G=s=>{De(s).then(a=>{a.code===0?(v("修改成功"),C(),o.value=!1):v(a.msg)}).catch(a=>{v(a)}).finally(()=>{w.value=!1})},J=()=>{var s;if(o.value){const a={homeId:I.userInfo.homeId,client:t.client.value,applicationId:k};a.expenseTypeId=t.expenseTypeId,a.amount=t.price.value,a.payTime=Math.floor(new Date(t.payTime).getTime()),a.remark=t.desc,a.photos=(s=h.value)==null?void 0:s.getValues(),G(a)}else o.value=!0},P=()=>{S.value.taggleVisible(!0)},K=s=>{t.feeType.value=s==null?void 0:s[0].text,t.expenseTypeId=s==null?void 0:s[0].value},W=(s,a)=>{t.payTime=Math.floor(new Date(`${s[0]}-${s[1]}-${s[2]}T${a[0]}:${a[1]}`).getTime()/1e3)},X=()=>{y.value.taggleDialog(!0)},Z=()=>{o.value=!0},ee=s=>{Ce({applicationId:k,homeId:I.userInfo.homeId}).then(a=>{a.code===0?(N(),v("删除成功"),y.value.taggleDialog(!1)):v(a.msg)}).catch(a=>{v(a)})},L=s=>{H.value=s},te=s=>{V.value.taggleModal(s)},ae=s=>s.replace(/[^0-9.,]/g,"");return pe(async()=>{C({doFun:E}),R.value=await Y.getCostType}),(s,a)=>{const se=f("UploadImg"),oe=f("AppUploadImg"),le=f("BaseHandleBtn"),ne=f("BtmSingleBtn"),ie=f("TimeSelect"),re=f("ConfrimPopAgain"),ce=f("PreviewImage"),ue=f("MainContainer");return n(),b(ue,{exitLoading:!0,pageLoading:e(j)},{default:g(()=>[i(Te,{title:o.value?"支出修改":"支出详情"},{rightContent:g(()=>[[1,2,6].includes(e(t).status)?(n(),r("img",{key:0,class:"pay-details-state-img",src:e(xe)(e(t).status===1?"wait":e(t).status===2?"pass":"zuofei"),alt:"",srcset:""},null,8,Be)):d("",!0)]),_:1},8,["title"]),l("div",He,[i(_,{label:e(c)("base.nameTxt"),valData:e(t).name},null,8,["label","valData"]),i(_,{label:e(c)("base.payMoneyTxt"),isRequire:o.value},{default:g(()=>[o.value?(n(),r("div",Ve,[i(e(F),{class:"form-item-price",modelValue:e(t).price.value,"onUpdate:modelValue":a[0]||(a[0]=p=>e(t).price.value=p),formatter:ae,type:"number",placeholder:"0"},null,8,["modelValue"]),l("span",Ae,u(e(t).currency),1)])):(n(),r("div",Pe,u(e(ke)(e(t).price.value))+" "+u(e(t).currency),1))]),_:1},8,["label","isRequire"]),i(_,{label:e(c)("base.gasTypeTxt"),isHaveRArrow:o.value,onOnHandle:a[2]||(a[2]=p=>o.value?P():()=>{})},{default:g(()=>[l("div",{class:"pydtl-val-item",onClick:a[1]||(a[1]=O(p=>o.value?P():()=>{},["stop"]))},u(e(t).feeType.value),1)]),_:1},8,["label","isHaveRArrow"]),i(_,{label:e(c)("base.belongHomeTxt"),valData:e(t).homeName},null,8,["label","valData"]),i(_,{label:e(c)("base.payTimeTxt"),isHaveRArrow:o.value,isRequire:o.value,onOnHandle:a[4]||(a[4]=p=>o.value?A(1):()=>{})},{default:g(()=>[l("div",{class:"pydtl-val-item",onClick:a[3]||(a[3]=O(p=>o.value?A(1):()=>{},["stop"]))},u(e(Ie)(e(t).payTime*1e3).format("YYYY-MM-DD HH:mm")),1)]),_:1},8,["label","isHaveRArrow","isRequire"]),e(t).status!==1?(n(),b(_,{key:0,label:e(c)("base.reviewerTxt")},{default:g(()=>[l("div",Le,u(e(t).auditIdentifyName),1)]),_:1},8,["label"])):d("",!0),z.value?(n(),r("div",$e,[o.value?d("",!0):(n(),r(x,{key:0},[l("div",Me,u(e(c)("base.descTxt")),1),l("div",Oe,u(e(t).desc),1)],64)),o.value?(n(),r("div",Ue,[l("div",Fe,[l("div",Ne,u(e(c)("base.descTxt")),1),l("div",qe,[l("span",null,u(e(t).desc.length),1),U("/200")])]),l("div",Ye,[i(e(F),{class:"form-textarea",maxlength:200,rows:"6",modelValue:e(t).desc,"onUpdate:modelValue":a[5]||(a[5]=p=>e(t).desc=p),placeholder:e(c)("base.descTxt")+":",type:"textarea"},null,8,["modelValue","placeholder"])])])):d("",!0)])):d("",!0),l("div",je,[o.value?(n(),r("div",Ge,[l("div",Je,[U(u(e(c)("base.pictrueTxt")),1),Ke]),e(T)?d("",!0):(n(),r("div",We,[i(se,{ref_key:"uploadImgRef",ref:h,maxCount:6,fileValues:e(D),onOnChangeIsLength:L},null,8,["fileValues"])])),e(T)?(n(),b(oe,{key:1,ref_key:"uploadImgRef",ref:h,value:e(D),maxCount:6,onOnChangeImg:L},null,8,["value"])):d("",!0)])):(n(),r(x,{key:0},[Ee,l("div",Qe,[(n(!0),r(x,null,fe(e(t).photo,(p,$)=>(n(),r("img",{key:$,src:p,onClick:ot=>te($)},null,8,ze))),128))])],64))]),e(t).status===1?(n(),r("div",Xe)):d("",!0),!o.value&&e(t).status===1?(n(),r("div",Ze,[i(le,{firBtnTxt:"删除记录",secBtnTxt:"修改记录",onOnFirBtnHandle:X,onOnSecBtnHandle:Z})])):d("",!0),o.value?(n(),r("div",et,[i(ne,{loading:w.value,disable:Q.value,handleTxt:"保存修改",onOnHandle:J},null,8,["loading","disable"])])):d("",!0)]),i(ie,{ref_key:"timeSelectRef",ref:B,onOnChangeVal:W},null,512),i(Re,{ref_key:"feeTypePopRef",ref:S,title:e(c)("base.selectFeeTpTxt"),data:R.value,onOnChange:K},null,8,["title","data"]),i(re,{ref_key:"confirmPopRef",ref:y,popClass:"staff-edit-dialog-box",customFooter:!0,onOnConfirm:ee},{default:g(()=>[tt]),_:1},512),i(ce,{ref_key:"previewImgRef",ref:V,imageList:e(t).photo},null,8,["imageList"])]),_:1},8,["pageLoading"])}}});export{dt as default};
