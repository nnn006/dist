import{l as fe,R as ve,r as f,a as C,d as ye,K as T,L as o,U as v,V as g,k as c,N as n,u as e,M as d,O as i,S as m,a6 as b,F as D,D as z,Q as ge}from"./vue.C2TeXnf4.js";import{d as _e,I as he,s as Te,j as be,q as ke,f as xe,t as H,A as Ie,n as M,k as J,u as Re,af as we,a as Ve}from"./index.C__3lhMr.js";import{_ as y}from"./BaseInfoItem.vue_vue_type_style_index_0_lang.MpSsZcmr.js";import{u as $e}from"./index.CeJqzCj5.js";import{u as Ce}from"./usePayDetails.Cy6__Q0s.js";import"./right-arrow-icon.CaFxgYzl.js";const De={class:"pay-details-box updata-staff-box container-setPx"},He={key:0,class:"hk-flex hk-items-center"},Me={class:"form-item-price-util"},Ae={key:1,class:"pydtl-val-item",style:{"font-weight":"500"}},Se={key:1,class:"pydtl-val-item"},Oe={key:1,class:"pydtl-val-item"},Ue={class:"pydtl-val-item"},Pe={key:9,class:"pydtl-info-item"},Ye={class:"pydtl-info-title"},qe={class:"pydtl-info-desc"},Le={key:1,class:"form-textarea-box"},Be={class:"hk-flex hk-jbetween hk-items-center form-textarea-t"},Ne={class:"form-textarea-tl"},Fe={class:"form-textarea-tr"},je={class:"form-textarea-b"},Ee={class:"pydtl-info-item"},We=n("div",{class:"pydtl-info-title"},"驳回原因",-1),Ge={class:"pydtl-info-desc"},Ke={key:10,class:"mpicture-info-item"},Qe=n("div",{class:"mpicture-info-title"},"照片",-1),ze={class:"mpicture-info-img hk-flex"},Je=["src","onClick"],Xe={key:1,class:"form-upload-img-box"},Ze={class:"form-upload-img-tit"},et=n("span",null,"*",-1),tt={key:0,class:"form-upload-img"},at=n("div",{class:"footer-aux-btmbox"},null,-1),lt={class:"footer-btn-box"},pt=fe({__name:"staffIndex",setup(st){_e();const X=ve(),A=he.inApp(),{id:Z}=X.query,{hkMessage:k}=Ve(),{getCostType:ee}=Te(),x=be(),R=f(!1);ke();const S=f([]),{applyInfo:a,getApplyDetails:O,fileList:U,baseImgUrl:ot}=Ce(),s=f(!1),P=f(null),Y=f(null),q=f(null),L=f(null),B=f(null),N=f([]),F=f(!0),w=f(null),j=f(null),p=C(()=>!(a.typ!==2&&a.typ!==3)),te=C(()=>p.value?!0:!!a.price.value&&F.value),ae=C(()=>p.value?!1:s.value?!0:!!a.desc),{t:r}=Re(),_=l=>{l===1?P.value.taggleVisible():l===2?L.value.taggleVisible():B.value.taggleVisible()},E=l=>{$e(l).then(t=>{t.code===0?(k("修改成功"),O(),s.value=!1):k(t.msg)}).catch(t=>{k(t)}).finally(()=>{R.value=!1})},le=()=>{var l;if(s.value){const t={homeId:x.userInfo.homeId,client:a.client.value,applicationId:Z};if(p.value){if(t.startTime=Math.floor(new Date(a.startTime).getTime()),t.endTime=Math.floor(new Date(a.endTime).getTime()),t.address=a.address.value,t.startTime>t.endTime){k("出车时间错误");return}R.value=!0,E(t)}else t.expenseTypeId=a.expenseTypeId,t.amount=a.price.value,t.payTime=Math.floor(new Date(a.payTime).getTime()),t.remark=a.desc,t.photos=(l=w.value)==null?void 0:l.getValues(),E(t)}else s.value=!0},W=()=>{q.value.taggleVisible(!0)},se=()=>new Promise((l,t)=>{we({homeId:x.userInfo.homeId}).then(I=>{if(I.code===0){const V=I.data.list.filter(h=>h.identifyId!==x.userInfo.identifyId).map(h=>({text:h.nickname,value:h.identifyId}));N.value=V,l(!0)}else t()})}),G=()=>{Y.value.taggleVisible(!0)},oe=l=>{a.feeType.value=l==null?void 0:l[0].text,a.expenseTypeId=l==null?void 0:l[0].value},ne=l=>{a.client.value=l==null?void 0:l[0].text,a.clientId=l==null?void 0:l[0].value},ie=(l,t)=>{a.startTime=Math.floor(new Date(`${l[0]}-${l[1]}-${l[2]}T${t[0]}:${t[1]}`).getTime()/1e3)},ue=(l,t)=>{a.endTime=Math.floor(new Date(`${l[0]}-${l[1]}-${l[2]}T${t[0]}:${t[1]}`).getTime()/1e3)},re=(l,t)=>{a.payTime=Math.floor(new Date(`${l[0]}-${l[1]}-${l[2]}T${t[0]}:${t[1]}`).getTime()/1e3)},K=l=>{F.value=l},de=l=>{j.value.taggleModal(l)},ce=l=>l.replace(/[^0-9.,]/g,"");return ye(async()=>{O(),se(),S.value=await ee(x.userInfo.homeId)}),(l,t)=>{const I=T("UploadImg"),V=T("AppUploadImg"),h=T("BtmSingleBtn"),$=T("TimeSelect"),me=T("PreviewImage"),pe=T("MainContainer");return o(),v(pe,null,{header:g(()=>[c(xe,{title:p.value?"结束出车详情":"支出详情"},null,8,["title"])]),default:g(()=>[n("div",De,[c(y,{label:e(r)("base.nameTxt"),valData:e(a).name},null,8,["label","valData"]),p.value?m("",!0):(o(),v(y,{key:0,label:e(r)("base.payMoneyTxt"),isRequire:s.value},{default:g(()=>[s.value?(o(),d("div",He,[c(e(H),{class:"form-item-price",modelValue:e(a).price.value,"onUpdate:modelValue":t[0]||(t[0]=u=>e(a).price.value=u),formatter:ce,type:"number",placeholder:"0"},null,8,["modelValue"]),n("span",Me,i(e(a).currency),1)])):(o(),d("div",Ae,i(e(Ie)(e(a).price.value))+" "+i(e(a).currency),1))]),_:1},8,["label","isRequire"])),p.value?m("",!0):(o(),v(y,{key:1,label:e(r)("base.gasTypeTxt"),isHaveRArrow:s.value,onOnHandle:t[2]||(t[2]=u=>s.value?G():()=>{})},{default:g(()=>[n("div",{class:"pydtl-val-item",onClick:t[1]||(t[1]=b(u=>s.value?G():()=>{},["stop"]))},i(e(a).feeType.value),1)]),_:1},8,["label","isHaveRArrow"])),p.value?(o(),v(y,{key:2,label:e(r)("base.consignerTxt"),isHaveRArrow:s.value,onOnHandle:t[3]||(t[3]=u=>s.value?W():()=>{})},{default:g(()=>[s.value?(o(),d("div",{key:0,onClick:b(W,["stop"])},i(e(a).client.value),1)):(o(),d("div",Se,i(e(a).client.value||"无"),1))]),_:1},8,["label","isHaveRArrow"])):m("",!0),c(y,{label:e(r)("base.belongHomeTxt"),valData:e(a).homeName},null,8,["label","valData"]),p.value?(o(),v(y,{key:3,label:e(r)("homeItem.address")},{default:g(()=>[s.value?(o(),v(e(H),{key:0,modelValue:e(a).address.value,"onUpdate:modelValue":t[4]||(t[4]=u=>e(a).address.value=u),placeholder:e(r)("base.pleaseInputTxt")},null,8,["modelValue","placeholder"])):(o(),d("div",Oe,i(e(a).address.value),1))]),_:1},8,["label"])):m("",!0),p.value?m("",!0):(o(),v(y,{key:4,label:e(r)("base.payTimeTxt"),isHaveRArrow:s.value,isRequire:s.value,onOnHandle:t[6]||(t[6]=u=>s.value?_(1):()=>{})},{default:g(()=>[n("div",{class:"pydtl-val-item",onClick:t[5]||(t[5]=b(u=>s.value?_(3):()=>{},["stop"]))},i(e(M)(e(a).payTime*1e3).format("YYYY-MM-DD HH:mm")),1)]),_:1},8,["label","isHaveRArrow","isRequire"])),p.value?(o(),v(y,{key:5,label:"出车时间",isHaveRArrow:s.value,isRequire:s.value,onOnHandle:t[8]||(t[8]=u=>s.value?_(1):()=>{})},{default:g(()=>[n("div",{class:"pydtl-val-item",onClick:t[7]||(t[7]=b(u=>s.value?_(1):()=>{},["stop"]))},i(e(M)(e(a).startTime*1e3).format("YYYY-MM-DD HH:mm")),1)]),_:1},8,["isHaveRArrow","isRequire"])):m("",!0),p.value?(o(),v(y,{key:6,label:"结束时间",isHaveRArrow:s.value,isRequire:s.value,onOnHandle:t[10]||(t[10]=u=>s.value?_(2):()=>{})},{default:g(()=>[n("div",{class:"pydtl-val-item",onClick:t[9]||(t[9]=b(u=>s.value?_(2):()=>{},["stop"]))},i(e(M)(e(a).endTime*1e3).format("YYYY-MM-DD HH:mm")),1)]),_:1},8,["isHaveRArrow","isRequire"])):m("",!0),e(a).status!==1?(o(),v(y,{key:7,label:e(r)("base.reviewerTxt")},{default:g(()=>[n("div",Ue,i(e(a).auditIdentifyName),1)]),_:1},8,["label"])):m("",!0),[1,2,3,4].includes(e(a).status)?(o(),v(y,{key:8,label:"状态",isStatusItem:!0,statusValue:e(a).status===1?"wait":e(a).status===2?"pass":e(a).status===3?"bohui":"stfWaitUpd"},null,8,["statusValue"])):m("",!0),ae.value?(o(),d("div",Pe,[s.value?(o(),d("div",Le,[n("div",Be,[n("div",Ne,i(e(r)("base.descTxt")),1),n("div",Fe,[n("span",null,i(e(a).desc.length),1),z("/200")])]),n("div",je,[c(e(H),{class:"form-textarea",maxlength:200,rows:"6",modelValue:e(a).desc,"onUpdate:modelValue":t[11]||(t[11]=u=>e(a).desc=u),placeholder:e(r)("base.descTxt")+":",type:"textarea"},null,8,["modelValue","placeholder"])])])):(o(),d(D,{key:0},[n("div",Ye,i(e(r)("base.descTxt")),1),n("div",qe,i(e(a).desc),1)],64))])):m("",!0),n("div",Ee,[We,n("div",Ge,i(e(a).reason),1)]),p.value?m("",!0):(o(),d("div",Ke,[s.value?(o(),d("div",Xe,[n("div",Ze,[z(i(e(r)("base.pictrueTxt")),1),et]),e(A)?m("",!0):(o(),d("div",tt,[c(I,{ref_key:"uploadImgRef",ref:w,maxCount:6,fileValues:e(U),onOnChangeIsLength:K},null,8,["fileValues"])])),e(A)?(o(),v(V,{key:1,ref_key:"uploadImgRef",ref:w,value:e(U),maxCount:6,onOnChangeImg:K},null,8,["value"])):m("",!0)])):(o(),d(D,{key:0},[Qe,n("div",ze,[(o(!0),d(D,null,ge(e(a).photo,(u,Q)=>(o(),d("img",{key:Q,src:u,onClick:nt=>de(Q)},null,8,Je))),128))])],64))])),at,n("div",lt,[c(h,{loading:R.value,disable:te.value,handleTxt:s.value?"保存":"马上修改",onOnHandle:le},null,8,["loading","disable","handleTxt"])])]),c($,{ref_key:"startTimeSelectRef",ref:P,onOnChangeVal:ie},null,512),c($,{ref_key:"endTimeSelectRef",ref:L,onOnChangeVal:ue},null,512),c($,{ref_key:"timeSelectRef",ref:B,onOnChangeVal:re},null,512),c(J,{ref_key:"feeTypePopRef",ref:Y,title:e(r)("base.selectFeeTpTxt"),data:S.value,onOnChange:oe},null,8,["title","data"]),c(J,{ref_key:"wprTypePopRef",ref:q,title:"选择委派人",data:N.value,onOnChange:ne},null,8,["data"]),c(me,{ref_key:"previewImgRef",ref:j,imageList:e(a).photo},null,8,["imageList"])]),_:1})}}});export{pt as default};
