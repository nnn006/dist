import{a as I,b,c as B,P as H,y as z,Q as J,g as V,O as $}from"./index.Cjri3_sP.js";import{_ as Q}from"./NewsItem.vue_vue_type_style_index_0_lang.CsWKk6Rr.js";import{d as j,l as u,m as E,g as F,p as U,o as W,e as q,Q as p,x as w,r as i,B as o,i as n,S as G}from"./vue.BCHSKM6y.js";const K={class:"news-main-content sf-news-main hk-pt-104"},X={class:"screen-box hk-flex hk-w-full"},Y={class:"screen-item"},Z={class:"hk-flex hk-items-center"},ee={class:"news-select-value"},ae={class:"screen-item"},te={class:"news-main-box"},se=["src"],ne=n("div",{class:"short-tips-dialog"},[n("div",{class:"pd-dialog-content"},"标记所有消息为已读？")],-1),pe=j({__name:"news",setup(oe){const{t:d}=b(),f=u(null),{hkMessage:g}=V(),{pushName:y}=B(),m=u([]),v=u(null),a=E({page:1,pageSize:10,total:0,curTime:0,allPayMoney:0,currency:""}),S=F(()=>[{text:d("base.screen.news.all"),value:0},{text:d("base.screen.news.pay"),value:1},{text:d("base.screen.news.end"),value:3}]),c=u({text:d("base.screen.news.all"),value:0}),{pageLoading:T,endPageLoading:x}=I({}),C=t=>{c.value=t,a.page=1,r()},r=t=>{const h={page:a.page,pageSize:a.pageSize,selectTime:Math.floor(a.curTime/1e3),selectNotifyType:c.value.value};H(h).then(s=>{if(s.code===0){const l=s.data.list.map(e=>({id:e.applicationId,title:e.title,value:e.typ===3?e.useCarTime:e.amount,type:e.typ===1?"price":e.typ===3?"time":"text",currencyType:e.currency,pic:e.identifyAvatar,applyState:e.status,active:!1,homeName:e.homeName,identifyName:e.identifyName,applicationTime:e.applicationTime,status:e.status,endTime:e.endTime,startTime:e.startTime,typ:e.typ}));a.page===1?m.value=l:m.value.push(...l),a.total=s.data.total,a.allPayMoney=s.data.allPayMoney,a.currency=s.data.currency}else g(s.msg)}).finally(()=>{var s,l;(s=f.value)==null||s.taggleRefreshState("isLoading",!1),(l=f.value)==null||l.taggleRefreshState("loading",!1),t&&t()})},k=t=>{window.sessionStorage.setItem("news",JSON.stringify({time:a.curTime,news:c.value})),y("PayStfDetails",{id:t.id})},R=()=>{a.page++,r()},L=()=>{a.page=1,r()},P=t=>{a.curTime=new Date(t).getTime(),a.page=1,r()},N=()=>{$().then(t=>{t.code===0?(r(),g("已成功标记所有消息"),v.value.taggleDialog(!1)):g(t.msg)})};return U(()=>{const t=window.sessionStorage.getItem("news");t&&(a.curTime=JSON.parse(t).time,c.value=JSON.parse(t).news,window.sessionStorage.removeItem("news")),r(x)}),(t,h)=>{const s=i("SvgIcon"),l=i("HkPopover"),e=i("MonthSelect"),A=i("SecondHeader"),M=i("DownRefresh"),O=i("ConfrimPopAgain"),D=i("MainContainer");return W(),q(D,{exitLoading:!0,pageLoading:w(T)},{default:p(()=>[o(z,{title:"消息"}),n("div",K,[o(A,null,{default:p(()=>[n("div",X,[n("div",Y,[o(l,{options:S.value,value:c.value.value,pannelClass:"news-minw-168",placement:"bottom-start",offset:[0,18],isSplitBorder:[0],isSelectState:!0,onOnChange:C},{taggleEle:p(()=>[n("div",Z,[n("span",ee,G(c.value.text),1),o(s,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value"])]),n("div",ae,[o(e,{isAll:a.curTime===0,value:a.curTime,onOnTimeChange:P},null,8,["isAll","value"])])])]),_:1}),n("div",te,[o(M,{ref_key:"downRefreshRef",ref:f,dataList:m.value,pagination:a,onOnRefresh:L,onOnLoad:R},{default:p(({data:_})=>[o(Q,{data:_,onClick:le=>k(_)},{examineState:p(()=>[n("img",{class:"msg-state-img",src:w(J)(_.status===3?"stfReject":"stfWaitUpd"),alt:"",srcset:""},null,8,se)]),_:2},1032,["data","onClick"])]),_:1},8,["dataList","pagination"])])]),o(O,{ref_key:"readAllRef",ref:v,popClass:"short-tips-pop",customFooter:!0,onOnConfirm:N},{default:p(()=>[ne]),_:1},512)]),_:1},8,["pageLoading"])}}});export{pe as default};
