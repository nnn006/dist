import{d as j,j as F,m as K,c as q,f as G,u as Q,aa as W,ab as X,ac as k,a as Y,b as Z}from"./index.C__3lhMr.js";import{_ as ee}from"./NewsItem.vue_vue_type_style_index_0_lang.C3OnuWsN.js";import{l as se,r as v,b as te,a as ae,d as ne,K as m,L as oe,U as le,V as r,k as l,N as a,O as b,u as ie}from"./vue.C2TeXnf4.js";const ce={class:"news-main-content"},re={class:"screen-box hk-flex hk-w-full"},pe={class:"screen-item"},ue={class:"hk-flex hk-items-center"},de={class:"head-select-value"},fe={class:"screen-item"},me={class:"hk-flex hk-items-center"},ve={class:"news-select-value"},ge={class:"screen-item"},he={class:"news-main-content hk-pt-104"},_e={class:"news-main-box"},ye=a("div",{class:"short-tips-dialog"},[a("div",{class:"pd-dialog-content"},"标记所有消息为已读？")],-1),Ie=se({name:"news",__name:"index",setup(we){const{t:n}=Q(),w=v(null),{hkMessage:S}=Y(),{pushName:g}=j(),{showLoading:C,closeLoading:x}=Z(),h=F(),T=v([]),I=v(null),{auth:_}=K(),{pageLoading:R,endPageLoading:N}=q({activeAction:L}),t=te({page:1,pageSize:10,total:0,curTime:0,allPayMoney:0,currency:""}),A=ae(()=>[{text:n("base.screen.news.all"),value:0},{text:"未读消息",value:1},{text:n("base.screen.news.pay"),value:2},{text:n("base.screen.news.start"),value:3},{text:n("base.screen.news.end"),value:4},{text:n("base.screen.news.imprest"),value:5}]),y=v([{text:n("base.screen.home.all"),value:0}]),p=v({text:n("base.screen.news.all"),value:0}),i=v({text:n("base.screen.home.all"),value:0}),O=e=>{p.value=e,t.page=1,C(),u(x)},D=e=>{i.value=e,t.page=1,C(),u(x)},u=e=>{const d={page:t.page,pageSize:t.pageSize,selectTime:Math.floor(t.curTime/1e3),selectNotifyType:p.value.value,homeId:i.value.value};W(d).then(o=>{if(o.code===0){const c=o.data.list.map(s=>({id:s.notifyId,applicationId:s.applicationId,title:s.title,value:s.typ===3||s.typ===2?s.useCarTime:s.amount,type:s.typ===3||s.typ===2?"time":"price",currencyType:s.currency,pic:s.identifyAvatar,applyState:s.status,active:!s.isRead,homeName:s.homeName,identifyName:s.identifyName,applicationTime:s.notifyTime,identifyId:s.identifyId,duties:s.duties,homeId:s.homeId,endTime:s.endTime,startTime:s.startTime,status:s.status,typ:s.typ}));d.page===1?T.value=c:T.value.push(...c),t.total=o.data.total}else S(o.msg)}).finally(()=>{var o,c;(o=w.value)==null||o.taggleRefreshState("isLoading",!1),(c=w.value)==null||c.taggleRefreshState("loading",!1),e&&e()})},P=e=>{e.active&&X({notifyId:e.id}).then(d=>{d.code===0&&h.updataReadNum(-1)}),window.sessionStorage.setItem("news",JSON.stringify({time:t.curTime,home:i.value,news:p.value})),e.typ===1||e.typ===3?g("PayDetails",{id:e.applicationId}):e.typ===4?g("ImpDetails",{id:e.applicationId}):e.typ===12||e.typ===13?g("StaffDetails",{id:e.identifyId,homeId:e.homeId,newsStatus:e.typ}):g("NewsDetails",{id:e.id,tp:e.typ})},M=()=>{t.page++,u()},B=()=>{t.page=1,u()},H=e=>{t.curTime=new Date(e).getTime(),t.page=1,C(),u(x)},z=()=>{k().then(e=>{e.code===0?(u(),S("已成功标记所有消息"),I.value.taggleDialog(!1)):S(e.msg)})},V=()=>{k().then(e=>{e.code===0&&(console.log("---clear-news--"),h.clearReadNum())})};async function L(){const e=window.sessionStorage.getItem("news");e?(t.curTime=JSON.parse(e).time,i.value=JSON.parse(e).home,p.value=JSON.parse(e).news,window.sessionStorage.removeItem("news")):(t.curTime=0,_===3||_===4||(i.value={text:n("base.screen.home.all"),value:0}),p.value={text:n("base.screen.news.all"),value:0}),t.page=1,u(N)}return ne(async()=>{await h.setHomeSimpleLs();const e=await h.homeSimple;_===3||_===4?(y.value=e,i.value=e[0]):y.value.push(...e),L()}),(e,d)=>{const o=m("SvgIcon"),c=m("HkPopover"),s=m("MonthSelect"),J=m("SecondHeader"),$=m("DownRefresh"),E=m("ConfrimPopAgain"),U=m("MainContainer");return oe(),le(U,{exitLoading:!0,pageLoading:ie(R)},{header:r(()=>[l(G,{title:"系统消息",onOnComeBack:V})]),headerScreen:r(()=>[a("div",ce,[l(J,null,{default:r(()=>[a("div",re,[a("div",pe,[l(c,{options:y.value,value:i.value.value,pannelClass:"news-minw-168",placement:"bottom-start",offset:[0,18],isSplitBorder:y.value.length>1?[0]:[],isSelectState:!0,onOnChange:d[0]||(d[0]=f=>D(f))},{taggleEle:r(()=>[a("div",ue,[a("span",de,b(i.value.text),1),l(o,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value","isSplitBorder"])]),a("div",fe,[l(c,{options:A.value,value:p.value.value,pannelClass:"news-minw-168",placement:"bottom",offset:[0,18],isSplitBorder:[0],isSelectState:!0,onOnChange:O},{taggleEle:r(()=>[a("div",me,[a("span",ve,b(p.value.text),1),l(o,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value"])]),a("div",ge,[l(s,{isAll:t.curTime===0,value:t.curTime,onOnTimeChange:H},null,8,["isAll","value"])])])]),_:1})])]),default:r(()=>[a("div",he,[a("div",_e,[l($,{ref_key:"downRefreshRef",ref:w,dataList:T.value,pagination:t,onOnRefresh:B,onOnLoad:M},{default:r(({data:f})=>[l(ee,{data:f,valColorClass:f.typ===7||f.typ===6?["val-color-yellow"]:f.typ===5?["val-color-blue"]:[],onClick:Se=>P(f)},null,8,["data","valColorClass","onClick"])]),_:1},8,["dataList","pagination"])])]),l(E,{ref_key:"readAllRef",ref:I,popClass:"short-tips-pop",customFooter:!0,onOnConfirm:z},{default:r(()=>[ye]),_:1},512)]),_:1},8,["pageLoading"])}}});export{Ie as default};
