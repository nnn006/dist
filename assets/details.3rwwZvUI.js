import{l as W,R as X,r as p,b as Z,a as ee,d as te,K as g,L as i,U as _,V as o,k as s,N as l,z as M,O as d,u as v,M as T,S as b,a6 as x}from"./vue.C2TeXnf4.js";import{j as ae,d as ne,c as se,f as oe,t as le,F as ie,k as de,u as ue,R as re,n as O,av as w,af as ce,a as me}from"./index.C__3lhMr.js";import{_ as u}from"./BaseInfoItem.vue_vue_type_style_index_0_lang.MpSsZcmr.js";import{u as fe,e as pe}from"./index.CeJqzCj5.js";import"./right-arrow-icon.CaFxgYzl.js";const ve={class:"updata-staff-box hk-flex hk-flex-col container-setPx"},ge={class:"updata-staff-form"},_e={key:1},Te={key:1},be=l("div",{class:"footer-aux-btmbox"},null,-1),Ie={key:0,class:"footer-btn-box"},ke={key:1,class:"footer-btn-box"},ye=l("div",{class:"staff-edit-dialog"},[l("div",{class:"pd-dialog-content"},"确定删除该条记录")],-1),Be=W({__name:"details",setup(he){const{t:y}=ue(),N=X(),{id:h}=N.query,C=p(null),H=p(null),S=p(null),$=p(null),B=p([]),c=ae(),{comeback:P,goback:Ce}=ne(),{hkMessage:r}=me(),n=p(!1),t=Z({nickname:c.userInfo.nickname,homeName:c.userInfo.homeName,client:"",address:"",applicationId:0,startTime:"",endTime:"",status:0,useCarTime:0,auditIdentifyName:"",clientId:0}),{pageLoading:L,endPageLoading:Y}=se({}),q=a=>{t.client=a==null?void 0:a[0].text,t.clientId=a==null?void 0:a[0].value},F=ee(()=>!!t.nickname),V=a=>{re({applicationId:h}).then(e=>{e.code===0?(t.client=e.data.client,t.clientId=e.data.clientId,t.address=e.data.address,t.applicationId=e.data.applicationId,t.startTime=e.data.startTime?O(e.data.startTime*1e3).format("YYYY-MM-DD HH:mm"):"",t.endTime=e.data.endTime?O(e.data.endTime*1e3).format("YYYY-MM-DD HH:mm"):"",t.status=e.data.status,t.useCarTime=e.data.useCarTime,t.auditIdentifyName=e.data.auditIdentifyName):r(e.msg)}).catch(e=>{r(e)}).finally(()=>{a&&a()})},I=a=>{a===1?H.value.taggleVisible():S.value.taggleVisible()},U=(a,e)=>{t.startTime=`${a[0]}-${a[1]}-${a[2]} ${e[0]}:${e[1]}`},z=(a,e)=>{t.endTime=`${a[0]}-${a[1]}-${a[2]} ${e[0]}:${e[1]}`},E=()=>{C.value.taggleDialog(!0)},A=()=>{$.value.taggleVisible(!0)},j=()=>{n.value=!0},K=()=>{const a={homeId:c.userInfo.homeId,client:t.client,applicationId:h,startTime:w(t.startTime),endTime:w(t.endTime),address:t.address};fe(a).then(e=>{e.code===0?(r("修改成功"),V(),n.value=!1):r(e.msg)}).catch(e=>{r(e)})},G=a=>{pe({applicationId:h,homeId:c.userInfo.homeId}).then(e=>{e.code===0?(P(),r("删除成功"),C.value.taggleDialog(!1)):r(e.msg)}).catch(e=>{r(e)})},J=()=>new Promise((a,e)=>{ce({homeId:c.userInfo.homeId}).then(k=>{if(k.code===0){const R=k.data.list.filter(m=>m.identifyId!==c.userInfo.identifyId).map(m=>({text:m.nickname,value:m.identifyId}));B.value=R,a(!0)}else e()})});return te(async()=>{J(),V(Y)}),(a,e)=>{const k=g("BaseHandleBtn"),R=g("BtmSingleBtn"),m=g("ConfrimPopAgain"),D=g("TimeSelect"),Q=g("MainContainer");return i(),_(Q,{exitLoading:!0,pageLoading:v(L)},{header:o(()=>[s(oe,{title:n.value?"修改出车":"出车详情"},null,8,["title"])]),default:o(()=>[l("div",ve,[l("div",ge,[s(u,{label:v(y)("base.nameTxt")},{default:o(()=>[l("div",{class:M({"info-no-input":n.value})},d(t.nickname),3)]),_:1},8,["label"]),s(u,{label:"目的地"},{default:o(()=>[n.value?(i(),_(v(le),{key:0,modelValue:t.address,"onUpdate:modelValue":e[0]||(e[0]=f=>t.address=f),placeholder:v(y)("base.pleaseInputTxt")},null,8,["modelValue","placeholder"])):(i(),T("div",_e,d(t.address),1))]),_:1}),t.status&&t.status!==1?(i(),_(u,{key:0,label:"出车时长"},{default:o(()=>[l("div",null,d(v(ie)(t.useCarTime)),1)]),_:1})):b("",!0),s(u,{label:v(y)("base.belongHomeTxt")},{default:o(()=>[l("div",{class:M({"info-no-input":n.value})},d(t.homeName),3)]),_:1},8,["label"]),s(u,{label:"委派人",isHaveRArrow:n.value,onOnHandle:e[1]||(e[1]=f=>n.value?A():()=>{})},{default:o(()=>[n.value?(i(),T("div",{key:0,onClick:x(A,["stop"])},d(t.client),1)):(i(),T("div",Te,d(t.client),1))]),_:1},8,["isHaveRArrow"]),t.status!==1?(i(),_(u,{key:1,label:"审核人"},{default:o(()=>[l("div",null,d(t.auditIdentifyName),1)]),_:1})):b("",!0),s(u,{label:"出车时间",isHaveRArrow:n.value,isRequire:n.value,onOnHandle:e[3]||(e[3]=f=>n.value?I(1):()=>{})},{default:o(()=>[l("div",{onClick:e[2]||(e[2]=x(f=>n.value?I(1):()=>{},["stop"]))},d(t.startTime),1)]),_:1},8,["isHaveRArrow","isRequire"]),s(u,{label:"结束时间",isHaveRArrow:n.value,isRequire:n.value,onOnHandle:e[5]||(e[5]=f=>n.value?I(2):()=>{})},{default:o(()=>[l("div",{onClick:e[4]||(e[4]=x(f=>n.value?I(2):()=>{},["stop"]))},d(t.endTime),1)]),_:1},8,["isHaveRArrow","isRequire"]),[1,2,6].includes(t.status)?(i(),_(u,{key:2,label:"状态",isStatusItem:!0,statusValue:t.status===1?"wait":t.status===2?"pass":"zuofei"},null,8,["statusValue"])):b("",!0)]),be,!n.value&&t.status===1?(i(),T("div",Ie,[s(k,{firBtnTxt:"删除记录",secBtnTxt:"修改记录",onOnFirBtnHandle:E,onOnSecBtnHandle:j})])):b("",!0),n.value?(i(),T("div",ke,[s(R,{disable:F.value,handleTxt:"保存修改",onOnHandle:K},null,8,["disable"])])):b("",!0)]),s(m,{ref_key:"confirmPopRef",ref:C,popClass:"staff-edit-dialog-box",customFooter:!0,onOnConfirm:G},{default:o(()=>[ye]),_:1},512),s(de,{ref_key:"feeTypePopRef",ref:$,title:"选择委派人",data:B.value,onOnChange:q},null,8,["data"]),s(D,{ref_key:"startTimeSelectRef",ref:H,onOnChangeVal:U},null,512),s(D,{ref_key:"endTimeSelectRef",ref:S,onOnChangeVal:z},null,512)]),_:1},8,["pageLoading"])}}});export{Be as default};
