import{o as O,L as U,A,T as F,n as H,Q as z,u as w,d as E,j as P,f as q,t as I,a as K}from"./index.C__3lhMr.js";import{l as D,r as u,L as $,M as Q,N as e,k as n,V as h,u as t,O as m,b as S,a as G,d as J,K as g,U as W,D as X}from"./vue.C2TeXnf4.js";import{c as Y,d as Z}from"./index.CeJqzCj5.js";import{_ as ee}from"./BaseInfoItem.vue_vue_type_style_index_0_lang.MpSsZcmr.js";import"./right-arrow-icon.CaFxgYzl.js";const te={class:"aplimp-item-box hk-flex"},ae={class:"aplimp-item-l"},se=["src"],oe={class:"aplimp-item-r"},le={class:"hk-flex hk-jbetween aplimp-item-rt"},ne={class:"aplimp-item-val-fbox hk-flex hk-items-center"},ie={class:"aplimp-item-val-box"},ce={class:"aplimp-item-cury"},re={class:"hk-flex hk-jbetween aplimp-item-rmbox"},de={class:"aplimp-item-rb"},pe=["src"],me=D({__name:"applyItem",props:{data:{default:()=>({})}},setup(R){w();const r=u(!1);return(i,v)=>($(),Q("div",te,[e("div",ae,[n(t(U),{dot:"",offset:["-3px","4px"],color:r.value?"#FF4938":"transparent"},{default:h(()=>[e("img",{class:"aplimp-item-img",src:t(O)+i.data.pic,srcset:""},null,8,se)]),_:1},8,["color"])]),e("div",oe,[e("div",le,[e("div",null,m(i.data.title),1),e("div",ne,[e("div",ie,[n(t(F),{class:"aplimp-item-value hk-fw-600",rows:"1",content:t(A)(i.data.price)},null,8,["content"])]),e("span",ce,m(i.data.currency),1)])]),e("div",re,[e("div",de,m(t(H)(i.data.time).format("MM-DD HH:mm")),1),e("img",{class:"aplimp-status-img",src:t(z)(i.data.state===1?"wait":i.data.state===2?"pass":"unpass"),alt:""},null,8,pe)])])]))}}),ue={class:"imprest-do-box imprest-apply-box hk-flex hk-flex-col hk-pt-52"},he={class:"pay-handle-box"},fe={class:"pay-handle-from form-pt-8"},_e={class:"hk-flex hk-items-center"},ge={class:"form-item-price-util"},ve={class:"form-textarea-box"},ye={class:"hk-flex hk-jbetween hk-items-center form-textarea-t"},be={class:"form-textarea-tl"},xe={class:"form-textarea-tr"},ke={class:"form-textarea-b"},Te={class:"imp-apply-lsbox"},Ie={class:"apply-record-header hk-flex hk-items-center hk-jbetween"},Se=e("span",{class:"apply-record-headerl"},"申请记录",-1),we={class:"imprest-apply-list"},Ve=D({__name:"apply",setup(R){const{t:r}=w(),{pushName:i}=E(),{hkMessage:v}=K(),f=P(),y=u(!1),b=u(null),s=S({money:"",desc:""}),k=u(""),L=G(()=>!!s.money&&Number(s.money)>0),c=S({page:1,pageSize:10,total:0,curTime:new Date().getTime()}),x=u([]),_=()=>{const a={page:c.page,pageSize:c.pageSize,selectTime:Math.floor(c.curTime/1e3),selectTimeTyp:2,homeId:f.userInfo.homeId,identifyId:f.userInfo.identifyId};Y(a).then(o=>{if(o.code===0){const d=o.data.list.map(l=>({title:"申请备用金",pic:l.identifyAvatar,job:"",time:l.applicationTime*1e3,homeName:l.homeName,id:l.applicationId,homeId:l.homeId,price:l.amount,currency:l.currency,state:l.status}));a.page===1?x.value=d:x.value.push(...d),c.total=o.data.total}}).finally(()=>{var o,d;(o=b.value)==null||o.taggleRefreshState("isLoading",!1),(d=b.value)==null||d.taggleRefreshState("loading",!1)})},M=()=>{c.page++,_()},T=()=>{c.page=1,_()},B=a=>{c.curTime=new Date(a).getTime(),c.page=1,_()},V=()=>{y.value=!0,Z({homeId:f.userInfo.homeId,amount:s.money,remark:s.desc}).then(a=>{a.code===0?(T(),v("申请已提交"),s.desc="",s.money=""):v(a.msg)}).finally(()=>{y.value=!1})},C=a=>a.replace(/[^0-9.,]/g,"");return J(async()=>{const a=await f.getSurplusRes;k.value=a.currency,_()}),(a,o)=>{const d=g("BtmSingleBtn"),l=g("MonthSelect"),N=g("DownRefresh"),j=g("MainContainer");return $(),W(j,null,{header:h(()=>[n(q,{title:t(r)("base.footer.imprest",{pre:t(r)("base.applyTxt")})},null,8,["title"])]),default:h(()=>[e("div",ue,[e("div",he,[e("div",fe,[n(ee,{label:"申请金额",isRequire:!0},{default:h(()=>[e("div",_e,[n(t(I),{class:"form-item-price",modelValue:s.money,"onUpdate:modelValue":o[0]||(o[0]=p=>s.money=p),formatter:C,type:"number",placeholder:"0"},null,8,["modelValue"]),e("span",ge,m(k.value),1)])]),_:1}),e("div",ve,[e("div",ye,[e("div",be,m(t(r)("base.descTxt")),1),e("div",xe,[e("span",null,m(s.desc.length),1),X("/200")])]),e("div",ke,[n(t(I),{class:"form-textarea",maxlength:200,rows:"6",modelValue:s.desc,"onUpdate:modelValue":o[1]||(o[1]=p=>s.desc=p),placeholder:t(r)("base.descTxt")+":",type:"textarea"},null,8,["modelValue","placeholder"])])])]),n(d,{class:"imp-do-btn",loading:y.value,disable:L.value,handleTxt:t(r)("base.applyTxt"),onOnHandle:V},null,8,["loading","disable","handleTxt"])]),e("div",Te,[e("div",Ie,[Se,n(l,{onOnTimeChange:B,iconColor:"#0D0D0D"})]),e("div",we,[n(N,{ref_key:"downRefreshRef",ref:b,dataList:x.value,pagination:c,onOnRefresh:T,onOnLoad:M},{default:h(({data:p})=>[n(me,{data:p,onClick:De=>t(i)("StaffImpDetails",{id:p.id})},null,8,["data","onClick"])]),_:1},8,["dataList","pagination"])])])])]),_:1})}}});export{Ve as default};
