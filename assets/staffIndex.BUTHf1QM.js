import{_ as K}from"./right-arrow-icon.CaFxgYzl.js";import{j as Q,c as q,d as G,w as R,L as W,M as X,u as Y,N as Z,F as A,o as ee,z as se,a as te}from"./index.C__3lhMr.js";import{l as ae,r as u,b as oe,a as S,d as ne,o as ce,K as h,L as b,U as le,V as f,k as o,N as s,u as l,O as T,D as U,z as B,M as w,Q as ie,F as re,S as ue}from"./vue.C2TeXnf4.js";import{A as fe}from"./index.DcHIdklB.js";const me="/assets/staff-pay-icon.p0PnBrAR.png",de="/assets/staff-car-icon.DtiDtyRt.png",he="/assets/staff-carAct-icon.mfJneek-.png",ve="/assets/staff-watter-icon.n86EStAD.png",_e="/assets/staff-msg-icon.KoBhP8sU.png",pe=s("span",null,null,-1),Ie={class:"staff-home-box"},ge={class:"staff-home-info"},Ce={class:"stfhome-staff-t hk-flex hk-jbetween"},Se=["src"],be={class:"stfhome-staff-name hk-flex"},Te={class:"stfhome-staff-tr"},we={class:"stahi-b hk-flex"},ke={class:"stahi-item"},xe={class:"stahi-item"},ye={class:"stfhome-staff-b stahi-b hk-flex"},Ne=s("div",{class:"stahi-item hk-flex hk-items-center"}," 待处理消息 ",-1),Le={class:"stahi-item hk-flex hk-items-center"},Ae={class:"sf-imp-wn-box"},Ue={class:"staff-home-content hk-flex"},Be=["onClick"],Pe={class:"stahc-item-label hk-flex hk-jbetween hk-items-center"},ze=s("img",{class:"stahc-item-arraw",src:K,alt:"",srcset:""},null,-1),Me={class:"stahc-item-icon"},Oe=["src"],Ve={key:0,class:"stahc-item-time"},Ke=ae({name:"StaffIndex",__name:"staffIndex",setup(Fe){const{t:v}=Y(),n=Q(),{pageLoading:P,endPageLoading:z}=q({activeAction:L}),{pushName:i,replacePath:$e}=G(),{hkMessage:M}=te(),_=u(0),t=oe({useCarTimeOut:null,useCarTime:"",useCarStartTime:0,serverTime:0}),k=u(""),r=u(1),p=u(!1),x=u({label:"homeItem.residueImprest",value:0,type:"number"}),y=u({label:"本月出车",value:0,type:"time",doLabel:!1}),O=S(()=>ee+n.userInfo.avatar),V=S(()=>se(n.userInfo.nickname,6)),F=S(()=>n.userInfo.duties),$=S(()=>[{label:v("base.payTxt"),icon:me,router:"Pay"},{label:r.value===1?v("base.useCarTxt"):"出车中",icon:r.value===1?he:de,class:r.value===1?[]:["icon-other-size"],router:"UseCar"},{label:v("base.footer.imprest"),icon:ve,router:"ImpApply"},{label:v("base.recordTxt"),icon:_e,router:"StaffRecord"}]),j=u([{name:"支出记录",value:"StaffRecord"},{name:"出车记录",value:"StaffCarRecord"},{name:"备用金记录",value:"StfImprestRecord"}]),D=e=>{var a;e==="Pay"?i(e,{homeId:n.userInfo.homeId,currency:k.value,payRole:1}):e==="StaffRecord"?p.value=!0:e==="UseCar"?(a=n.userInfo.permission)!=null&&a[1]?i(e):r.value===1?M("暂无出车权限"):i(e):i(e)},H=()=>{p.value=!1},E=e=>{i(e.value)},N=()=>{t.useCarTimeOut=setTimeout(()=>{t.serverTime+=60,t.useCarTime=A(t.serverTime-t.useCarStartTime),N()},60*1e3)};async function L(){var a,d,I,g,m,C;const e=await Z({homeId:n.userInfo.homeId});x.value.value=(a=e==null?void 0:e.data)==null?void 0:a.amount,y.value.value=(d=e==null?void 0:e.data)==null?void 0:d.useCarTime,k.value=(I=e==null?void 0:e.data)==null?void 0:I.currency,r.value=(g=e==null?void 0:e.data)==null?void 0:g.useCarStatus,r.value===2&&(t.serverTime=((m=e==null?void 0:e.data)==null?void 0:m.nowTime)||0,t.useCarStartTime=((C=e==null?void 0:e.data)==null?void 0:C.startTime)||0,t.useCarTime=A(t.serverTime-t.useCarStartTime),N()),_.value=n.untreatedSelfNum,n.setUserIdent(),z()}return ne(async()=>{L()}),ce(()=>{t.useCarTimeOut&&(clearTimeout(t.useCarTimeOut),t.useCarTimeOut=null)}),(e,a)=>{const d=h("SvgIcon"),I=h("LogoutBtn"),g=h("SecondHeader"),m=h("DataInfoItem"),C=h("MainContainer");return b(),le(C,{exitLoading:!0,pageLoading:l(P)},{header:f(()=>[o(R,{haveAdd:!1,haveMonth:!1,leftNewsIcon:!0,rightNewsIcon:!1,newsRoute:"news"},{comeback:f(()=>[o(I,null,{default:f(()=>[o(d,{class:"close-app-btnicon",iconClass:"close-app-btn",color:"#ffffff"})]),_:1})]),title:f(()=>[pe]),_:1})]),headerScreen:f(()=>[o(g,{noScreen:!0})]),default:f(()=>[s("div",Ie,[s("div",ge,[s("div",Ce,[s("div",{class:"stfhome-staff-tl",onClick:a[0]||(a[0]=c=>l(i)("StaffDetails",{id:l(n).userInfo.identifyId,homeId:l(n).userInfo.homeId,tp:"staff"}))},[s("img",{class:"stfhome-staff-img",src:O.value,alt:""},null,8,Se),s("div",be,[s("span",null,T(V.value),1),o(d,{iconClass:"right-arrow-icon",size:"12",color:"#999999"})])]),s("div",Te,[o(m,{valData:{label:"职务",type:"type",value:F.value},haveArrow:!1},null,8,["valData"])])]),s("div",we,[s("div",ke,[o(m,{valData:x.value},null,8,["valData"])]),s("div",xe,[o(m,{valData:y.value},null,8,["valData"])])]),s("div",ye,[Ne,s("div",Le,[s("div",Ae,[o(l(W),{class:"sf-imp-wn-badge",content:_.value,"show-zero":!1},null,8,["content"]),o(l(X),{plain:"",class:B(["sf-imp-wn-btn",{active:_.value>0}]),size:"mini",onClick:a[1]||(a[1]=c=>l(i)("StaffNews"))},{default:f(()=>[U(T(_.value>0?"去处理":"暂无消息"),1)]),_:1},8,["class"])])])])]),s("div",Ue,[(b(!0),w(re,null,ie($.value,(c,J)=>(b(),w("div",{class:"stahc-item ripple-effect-card",key:J,onClick:je=>D(c.router)},[s("div",Pe,[U(T(c.label)+" ",1),ze]),s("div",Me,[s("img",{src:c.icon,class:B(c.class),alt:"",srcset:""},null,10,Oe)]),c.router==="UseCar"&&r.value===2?(b(),w("div",Ve,"已出车: "+T(t.useCarTime),1)):ue("",!0)],8,Be))),128))])]),o(l(fe),{class:"hk-action-sheet",show:p.value,"onUpdate:show":a[2]||(a[2]=c=>p.value=c),actions:j.value,"cancel-text":"取消","close-on-click-action":"",onCancel:H,onSelect:E},null,8,["show","actions"])]),_:1},8,["pageLoading"])}}});export{Ke as default};
