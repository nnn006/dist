import{c as Q,d as q,f as G,h as X,F as A,a as Z}from"./index.C__3lhMr.js";import{_ as ee}from"./NewsItem.vue_vue_type_style_index_0_lang.C3OnuWsN.js";import{c as te,s as ae}from"./index.DNWpiEF6.js";import{l as se,r as f,b as R,d as oe,L as l,U as ne,V as _,u as T,K as M,k as w,N as n,O as u,M as d,Q as D,F as C,z as P,S as ie}from"./vue.C2TeXnf4.js";const re={class:"work-overtime-box hk-pt-52"},le={class:"wot-header"},ce={class:"wot-header-px12"},de={class:"wot-time-label"},ue={class:"wot-time-static-box"},me={class:"wot-time-static hk-flex"},he={class:"value"},fe=n("div",{class:"label"},"工作时长",-1),ve={class:"wot-time-static hk-flex"},ye={class:"value"},pe=n("div",{class:"label"},"加班时长",-1),ge={class:"wot-calendar-box hk-flex"},_e=["onClick"],Te=n("div",{class:"wot-list-header hk-flex hk-items-center"},[n("div",{class:"wot-ls-tag"}),n("div",null,"出车")],-1),we=n("div",null,null,-1),De={key:0,class:"wot-list-empty-box"},Ie=se({__name:"index",setup(Ce){const{hkMessage:b}=Z(),{pushName:Y}=q(),F=["日","一","二","三","四","五","六"],v=f([]),k=f(-1),y=f(-1),h=f([]),x=f(null),m=R({page:1,pageSize:10,total:0}),o=R({homeId:0,identifyInfo:{text:"",value:0},selectTime:0,selectTimeTyp:2,overUseCarTime:0,useCarTime:0,preDays:[],nextDays:[]}),p=()=>({year:new Date(o.selectTime).getFullYear(),month:new Date(o.selectTime).getMonth()}),O=()=>{const e=p().year;return e%400===0||e%100!==0&&e%4===0},g=(e,t)=>{let c=[31,null,31,30,31,30,31,31,30,31,30,31][t]||(O()?29:28);return Array.from(new Array(c),(r,s)=>s+1)},U=()=>new Date(o.selectTime).getDay(),V=()=>{const{month:e,year:t}=p();return e===0?g(t-1,11):g(t,e-1)},z=()=>{const{month:e,year:t}=p();return e===11?g(t+1,0):g(t,e+1)},{pageLoading:B,endPageLoading:$}=Q({activeAction:S}),W=()=>{const e=U();o.preDays=e?V().slice(-1*e):[];const t=z(),i=42-v.value.length-e;o.nextDays=i?t.slice(0,i):[]},j=()=>{const{month:e,year:t}=p(),i=new Date().getFullYear(),c=new Date().getMonth();t===i&&e===c&&(y.value=new Date().getDate()-1),I(y.value===-1?0:y.value)},I=e=>{k.value=e},E=e=>{I(e),N()};function S(){const e=window.sessionStorage.getItem("statisticDetails");if(e){const t=JSON.parse(e);if(t.time){const i=new Date(t.time);i.setDate(1),o.selectTime=i.getTime()}t.tabVal&&(o.selectTimeTyp=t.tabVal),t.staff&&(o.identifyInfo=t.staff),t.home&&(o.homeId=t.home.value)}j(),K()}const H=()=>{m.page++,L()},N=()=>{m.page=1,L()},L=()=>new Promise(e=>{var c;const t=(c=v.value[k.value])==null?void 0:c.date,i={page:m.page,pageSize:m.pageSize,homeId:o.homeId,selectTime:t,selectTimeTyp:3,identifyId:o.identifyInfo.value};ae(i).then(r=>{if(r.code===0){const s=r.data.list.map(a=>({id:a.id,title:a.title,value:a.useCarTime,type:"time",currencyType:a.currency,pic:a.identifyAvatar,applyState:a.status,active:!1,homeName:a.homeName,identifyName:a.identifyName,applicationTime:a.applicationTime,status:a.status,useCarTime:a.useCarTime,endTime:a.endTime,startTime:a.startTime,typ:a.typ}));i.page===1?h.value=s:h.value.push(...s),m.total=r.data.total}else b(r.msg)}).finally(()=>{var r,s;(r=x.value)==null||r.taggleRefreshState("isLoading",!1),(s=x.value)==null||s.taggleRefreshState("loading",!1),e(!0)})}),J=e=>{Y("PayDetails",{id:e.id})},K=()=>{te({homeId:o.homeId,identifyId:o.identifyInfo.value,selectTime:Math.floor(o.selectTime/1e3),selectTimeTyp:o.selectTimeTyp}).then(e=>{e.code===0?(v.value=e.data.list.map(t=>({...t,day:new Date(t.date*1e3).getDate()})),o.overUseCarTime=e.data.overUseCarTime,o.useCarTime=e.data.useCarTime,W(),L()):b(e.msg)}).finally(()=>{$()})};return oe(()=>{S()}),(e,t)=>{const i=M("DownRefresh"),c=M("hk-empty"),r=M("MainContainer");return l(),ne(r,{exitLoading:!0,pageLoading:T(B)},{header:_(()=>[w(G,{title:"时长统计"})]),default:_(()=>[n("div",re,[n("div",le,[n("div",ce,[n("div",de,u(T(X)(o.selectTime,"YYYY年MM月")),1),n("div",ue,[n("div",me,[n("div",he,u(T(A)(o.useCarTime)),1),fe]),n("div",ve,[n("div",ye,u(T(A)(o.overUseCarTime)),1),pe])])]),n("div",ge,[(l(),d(C,null,D(F,(s,a)=>n("div",{class:"wot-calendar-item",key:a},u(s),1)),64)),(l(!0),d(C,null,D(o.preDays,(s,a)=>(l(),d("div",{class:"wot-calendar-item after-before-month",key:a},u(s),1))),128)),(l(!0),d(C,null,D(v.value,(s,a)=>(l(),d("div",{class:"wot-calendar-item",key:s.date,onClick:ke=>E(a)},[n("div",{class:P(["wot-calendar-act",{active:a===k.value,"cur-day":y.value===a,"user-car-tag":s.useCarTime,"work-overtime-tag":s.overTime}])},u(s.day),3)],8,_e))),128)),(l(!0),d(C,null,D(o.nextDays,(s,a)=>(l(),d("div",{class:"wot-calendar-item after-before-month",key:a},u(s),1))),128))])]),Te,n("div",{class:P(["wot-list",{"wot-list-empty":h.value.values.length===0}])},[w(i,{ref_key:"downRefreshRef",ref:x,dataList:h.value,pagination:m,onOnRefresh:N,onOnLoad:H},{default:_(({data:s})=>[w(ee,{data:s,valColorClass:s.typ===7||s.typ===6?["val-color-yellow"]:s.typ===5?["val-color-blue"]:[],onClick:a=>J(s)},null,8,["data","valColorClass","onClick"])]),empty:_(()=>[we]),_:1},8,["dataList","pagination"])],2),h.value.length===0?(l(),d("div",De,[w(c)])):ie("",!0)])]),_:1},8,["pageLoading"])}}});export{Ie as default};
