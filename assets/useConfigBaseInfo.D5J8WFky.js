import{b as G,h as K,u as Q,a3 as W,a5 as X,av as Y}from"./index.Cjri3_sP.js";import{_ as Z,l as c,g as L,m as $,s as j,p as ee,k as te,t as ae}from"./vue.BCHSKM6y.js";const oe=T=>{var C,J,M,N;const{t:o}=G(),{isStaff:H}=K(),n=Z();let y=(C=n.query)==null?void 0:C.homeId,b=(J=n.query)==null?void 0:J.fee,v=(M=n.query)==null?void 0:M.stfId,d=(N=n.query)==null?void 0:N.pageTp;const I=c(!0),g=c(!0),R=()=>{g.value=!1},V=Q(),_=W(),O=c(2),z=L(()=>[{title:o("base.tabs.monthBill"),value:2},{title:o("base.tabs.yearBill"),value:1}]),E=L(()=>[{title:o("base.tabs.monthCar"),value:2},{title:o("base.tabs.yearCar"),value:1}]),F=L(()=>[{title:"月预支",value:2},{title:"年预支",value:1}]),u=c([{text:o("base.screen.allStaff"),value:0}]),r=c([{text:"人员",value:0}]),m=c([{text:o("base.screen.allType"),value:0}]),p=c([]),e=$({home:{text:o("base.screen.home.all"),value:0},staff:{text:o("base.screen.allStaff"),value:0},type:{text:o("base.screen.allType"),value:0},member:{text:"人员",value:0}}),q=()=>new Promise((f,i)=>{X({homeId:e.home.value}).then(l=>{if(l.code===0){const s=l.data.list.map(t=>({text:t.nickname,value:t.identifyId}));r.value=[r.value[0],...s],f(!0)}else i()}).catch(l=>{i()})}),A=()=>new Promise((f,i)=>{const l={homeId:e.home.value};d==="3"&&(l.identifyType=4),Y(l).then(s=>{if(s.code===0){const t=s.data.list.map(a=>({text:a.nickname,value:a.identifyId}));u.value=[u.value[0],...t],f(!0)}else i()}).catch(s=>{i()})}),P=async()=>{await V.setHomeSimpleLs();const f=V.homeSimple,i=await _.setCostType();p.value=f,m.value=[{text:o("base.screen.allType"),value:0},...i,{text:"已删除类型",value:-1},{text:"作废单",value:-2}];const l=window.sessionStorage.getItem("statisticDetails");if(l){const s=JSON.parse(l);if(s.home)e.home=s.home;else{const t=p.value.filter(a=>a.value===+y);t.length?e.home=t[0]:e.home=p.value[0]}if(s.fee)e.type=s.fee;else{const t=m.value.filter(a=>a.value===+b);t.length?e.type=t[0]:e.type=m.value[0]}}else{const s=p.value.filter(a=>a.value===+y);s.length?e.home=s[0]:e.home=p.value[0];const t=m.value.filter(a=>a.value===+b);t.length?e.type=t[0]:e.type=m.value[0]}if(d&&!H.value)try{if(await(d==="1"?q:A)(),d==="1")if(l){const t=JSON.parse(l);if(t.staff)e.member=t.staff;else{const a=r.value.filter(h=>h.value===+v);a.length?e.member=a[0]:e.member=r.value[0]}}else{const t=r.value.filter(a=>a.value===+v);t.length?e.member=t[0]:e.member=r.value[0]}else if(l){const t=JSON.parse(l);if(t.staff)e.staff=t.staff;else{const a=u.value.filter(h=>h.value===+v);a.length?e.staff=a[0]:e.staff=u.value[0]}}else{const t=u.value.filter(a=>a.value===+v);t.length?e.staff=t[0]:e.staff=u.value[0]}}catch{}window.sessionStorage.removeItem("statisticDetails"),T.loadList&&(await T.loadList(),R())};return j(()=>{var f,i,l,s,t,a,h,k;if(!I.value){console.log("----onActivated----",O.value);const B=window.sessionStorage.getItem("statisticDetails"),x=(f=n.query)==null?void 0:f.homeId,D=(i=n.query)==null?void 0:i.fee,w=(l=n.query)==null?void 0:l.stfId,U=(s=n.query)==null?void 0:s.pageTp;if((x!==y||D!==b||w!==v)&&(g.value=!0),B||(x!==((t=e.home)==null?void 0:t.value)+""||D!==((a=e.type)==null?void 0:a.value)+""||w!==((h=e.staff)==null?void 0:h.value)+""&&((k=e.staff)==null?void 0:k.value)!==0)&&(g.value=!0),+U==3){const S=JSON.parse(B);S!=null&&S.staff&&e.staff.value!==S.staff.value&&(g.value=!0)}y=x,b=D,v=w,d=U,P()}}),ee(async()=>{console.log("----onMounted----"),P()}),te(()=>{console.log("----onUnmounted----"),I.value=!1}),ae(()=>{console.log("----onDeactivated----"),I.value=!1}),{hTabData:z,carTabData:E,imprestTabData:F,homeSelectData:p,feeOption:m,screenVal:e,curValue:O,staffOption:u,memberOption:r,pageLoading:g,getMemberList:q,getStaffList:A}};export{oe as u};
