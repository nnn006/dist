import{l as N,R as P,r as d,b as U,a as E,d as L,K as g,L as $,U as x,V as r,k as n,N as u,a6 as C,O as h,u as R,S as j}from"./vue.C2TeXnf4.js";import{j as q,d as F,f as K,t as z,k as G,u as J,af as Q,n as V,av as S,a as W}from"./index.C__3lhMr.js";import{_ as p}from"./BaseInfoItem.vue_vue_type_style_index_0_lang.MpSsZcmr.js";import{g as X,h as Z,i as ee}from"./index.CeJqzCj5.js";import"./right-arrow-icon.CaFxgYzl.js";const te={class:"updata-staff-box hk-flex hk-flex-col container-setPx"},ae={class:"updata-staff-form"},ne={class:"deal-car-btnbox hk-flex"},me=N({__name:"deal",setup(se){const{t:y}=J();P(),d(null);const T=d(null),I=d(null),_=d(null),s=q(),{comeback:b,goback:oe}=F(),{hkMessage:o}=W();d(!1);const k=d([]),t=U({nickname:s.userInfo.nickname,homeName:s.userInfo.homeName,client:"",address:"",applicationId:0,startTime:"",endTime:"",useCarStatus:0,clientId:0}),H=E(()=>!!t.startTime),M=e=>{t.client=e==null?void 0:e[0].text,t.clientId=e==null?void 0:e[0].value},v=()=>{_.value.taggleVisible(!0)},O=()=>new Promise((e,a)=>{Q({homeId:s.userInfo.homeId}).then(c=>{if(c.code===0){const f=c.data.list.filter(i=>i.identifyId!==s.userInfo.identifyId).map(i=>({text:i.nickname,value:i.identifyId}));k.value=f,e(!0)}else a()})}),A=()=>{X({homeId:s.userInfo.homeId}).then(e=>{e.code===0?(t.client=e.data.client,t.clientId=e.data.clientId,t.address=e.data.address,t.applicationId=e.data.applicationId,t.startTime=e.data.startTime?V(e.data.startTime*1e3).format("YYYY-MM-DD HH:mm"):T.value.getCurrTime(),t.endTime=e.data.endTime?V(e.data.endTime*1e3).format("YYYY-MM-DD HH:mm"):I.value.getCurrTime(),t.useCarStatus=e.data.useCarStatus):o(e.msg)}).catch(e=>{o(e)})},m=e=>{e===1?T.value.taggleVisible():I.value.taggleVisible()},Y=(e,a)=>{t.startTime=`${e[0]}-${e[1]}-${e[2]} ${a[0]}:${a[1]}`},w=(e,a)=>{t.endTime=`${e[0]}-${e[1]}-${e[2]} ${a[0]}:${a[1]}`},B=()=>{Z({homeId:s.userInfo.homeId,startTime:S(t.startTime),clientId:t.clientId,address:t.address}).then(e=>{e.code===0?(o("出车成功"),b()):o(e.msg)})},D=()=>{if(!t.endTime){o("结束出车时间未填");return}ee({homeId:s.userInfo.homeId,startTime:S(t.startTime),clientId:t.clientId,address:t.address,endTime:S(t.endTime)}).then(e=>{e.code===0?(o("结束出车成功"),b()):o(e.msg)})};return L(async()=>{O(),A()}),(e,a)=>{const c=g("BtmSingleBtn"),f=g("TimeSelect"),i=g("MainContainer");return $(),x(i,null,{header:r(()=>[n(K,{title:t.useCarStatus===1?"开始出车":t.useCarStatus===2?"结束出车":""},null,8,["title"])]),default:r(()=>[u("div",te,[u("div",ae,[n(p,{label:"委派人",isHaveRArrow:!0,onOnHandle:v},{default:r(()=>[u("div",{onClick:C(v,["stop"])},h(t.client),1)]),_:1}),n(p,{label:"目的地"},{default:r(()=>[n(R(z),{modelValue:t.address,"onUpdate:modelValue":a[0]||(a[0]=l=>t.address=l),placeholder:R(y)("base.pleaseInputTxt")},null,8,["modelValue","placeholder"])]),_:1}),n(p,{label:"出车时间",isHaveRArrow:!0,isRequire:!0,onOnHandle:a[2]||(a[2]=l=>m(1))},{default:r(()=>[u("div",{onClick:a[1]||(a[1]=C(l=>m(1),["stop"]))},h(t.startTime),1)]),_:1}),t.useCarStatus===2?($(),x(p,{key:0,label:"结束时间",isHaveRArrow:!0,isRequire:!0,onOnHandle:a[4]||(a[4]=l=>m(2))},{default:r(()=>[u("div",{onClick:a[3]||(a[3]=C(l=>m(2),["stop"]))},h(t.endTime),1)]),_:1})):j("",!0),u("div",ne,[n(c,{class:"deal-car-btn",disable:H.value,handleTxt:t.useCarStatus===1?"开始出车":"结束出车",onOnHandle:a[5]||(a[5]=l=>t.useCarStatus===1?B():D())},null,8,["disable","handleTxt"])])])]),n(G,{ref_key:"feeTypePopRef",ref:_,title:"选择委派人",data:k.value,onOnChange:M},null,8,["data"]),n(f,{ref_key:"startTimeSelectRef",ref:T,onOnChangeVal:Y},null,512),n(f,{ref_key:"endTimeSelectRef",ref:I,onOnChangeVal:w},null,512)]),_:1})}}});export{me as default};
