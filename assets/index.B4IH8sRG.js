import{l as oe,r as c,J as ne,R as ie,b as le,e as ce,d as re,o as ue,K as y,L as r,U as de,V as f,N as a,k as i,O as _,M as u,Q as J,F as U,S as k,u as h}from"./vue.C2TeXnf4.js";import{m as me,d as fe,j as he,f as pe,w as ve,x as ye,u as _e,b as ge,y as Se,z as Ie,A as we,B as De,C as be,o as ke,D as Te}from"./index.C__3lhMr.js";import{_ as Ne}from"./HDetailsOptions.vue_vue_type_style_index_0_lang.Bo0YUPQB.js";import{A as xe}from"./index.DcHIdklB.js";const Ae=a("span",null,null,-1),Oe={class:"home-details-box hk-pt-noScreen"},He={class:"home-header-info"},Pe={class:"home-pay-class-box"},Ce={class:"hdetails-card-header hdetails-card-p hk-flex hk-jbetween hk-items-center"},Le={class:"hdetails-card-tit"},Me=a("span",{class:"hdetails-card-more"},null,-1),je={class:"home-pay-class-content hk-flex"},Be={key:0,class:"data-empty-fbox"},qe={class:"home-staff-box"},Je=a("div",{class:"hdetails-card-header hdetails-card-p hk-flex hk-jbetween hk-items-center"},[a("span",{class:"hdetails-card-tit"},"员工"),a("span",{class:"hdetails-card-more"})],-1),Ue={class:"home-staff-content"},$e=["onClick"],Ve={class:"home-staff-t hk-flex hk-jbetween"},Qe={class:"home-staff-tl"},Re=["src"],Fe={class:"home-staff-name"},ze={class:"home-staff-tr"},Ee={class:"home-staff-b hk-flex hk-jbetween"},Ke={class:"home-staff-bl"},Ge={class:"hdetails-member-item hk-flex hk-items-center"},We={class:"hk-fw-600"},Xe={key:0,class:"home-staff-br"},Ye={key:0,class:"data-empty-fbox"},ot=oe({name:"homeDetails",__name:"index",setup(Ze){var B;_e();const{auth:T}=me(),g=c(!0),N=()=>{g.value=!1};ne();const x=ie(),{pushName:$}=fe(),{showLoading:V,closeLoading:Q}=ge();let s=(B=x.query)==null?void 0:B.homeId;const S=he(),A=c(0),R=c(!1),o=c(new Date().getTime()),O=c(),I=c([]),d=le({list:[],currency:""});let m=null;const p=c(!1),F=c([{name:T===3?"划拨备用金":"发放备用金",value:5},{name:"收回备用金",value:7},{name:"员工备用金详情",value:"StatisticDetails"}]),H=e=>{O.value={title:e.data.nickname,pic:e.data.avatar,currency:e.data.currency,id:e.data.homeId,statistic:[{label:"homeItem.payMoney",value:e.data.payMoney,type:"price",haveInfoArrow:!0,routeName:"StatisticDetails",otherQuery:{homeId:s,qtime:o.value,pageTp:1,fee:0},setSession:{time:o.value}},{label:"homeItem.carTime",value:e.data.useCarTime,type:"time",haveInfoArrow:!0,routeName:"StatisticDetails",otherQuery:{homeId:s,qtime:o.value,pageTp:3,fee:0},setSession:{time:o.value}},{label:"homeItem.preImprest",value:e.data.amount,type:"number",haveInfoArrow:!0,routeName:"StatisticDetails",otherQuery:{homeId:s,qtime:o.value,pageTp:2,fee:0},setSession:{time:o.value}},{label:"homeItem.staffNum",value:e.data.employeesNum,type:"people",haveInfoArrow:!0,routeName:"StaffManage",otherQuery:{homeId:s}}]}},z=()=>new Promise(e=>{De({homeId:s,selectTime:Math.floor(o.value/1e3)}).then(t=>{t.code===0&&H(t)}).finally(()=>{e(!0)})}),P=e=>{d.currency=e.currency,d.list=e.list.map(t=>({type:"number",label:t.expenseType,value:t.payMoney,expenseTypeId:t.expenseTypeId}))},E=()=>new Promise(e=>{be({homeId:s,selectTime:Math.floor(o.value/1e3),selectTimeTyp:2}).then(t=>{t.code===0&&P(t.data)}).finally(()=>{e(!0)})}),C=e=>{I.value=e.list.map(t=>({picture:ke+t.avatar,name:t.nickname,id:t.identifyId,amount:t.amount,identifyType:t.identifyType,currency:t.currency,jop:{label:"homeItem.jop",value:t.duties,type:"text"},residueImprest:{value:"",type:"price",label:"homeItem.residueImprest"},doTask:{value:t.useCarTime,type:"time",label:"homeItem.carTime"}}))},K=()=>new Promise(e=>{Te({page:1,pageSize:999,homeId:s,selectTime:Math.floor(o.value/1e3)}).then(t=>{t.code===0&&C(t.data)}).finally(()=>{e(!0)})}),L=()=>{const e=window.sessionStorage.getItem("homeDetailsData");if(e){const t=JSON.parse(e);H({data:t.homeStatisticsInfo}),P(t.payStatisticsInfo),C(t.staffStatisticsList),window.sessionStorage.removeItem("homeDetailsData"),N()}else Promise.all([z(),E(),K()]).then(()=>{N(),Q()});(S.userInfo.identifyType===1||S.userInfo.identifyType===2)&&G()},G=()=>{Se({homeId:s}).then(e=>{e.code===0&&(A.value=e.data.untreatedNum)})},W=e=>{o.value=new Date(e).getTime(),V(),L()},l=(e,t)=>{$(e,t)},X=()=>{l("Pay",{homeId:s,currency:d.currency})},Y=e=>{window.sessionStorage.setItem("toStatic",JSON.stringify({time:o.value})),l("StatisticDetails",{homeId:s,qtime:o.value,pageTp:1,fee:e.expenseTypeId})},Z=()=>{l("DataReview",{homeId:s})},ee=e=>{m=e,p.value=!0},te=(e,t,w)=>{window.sessionStorage.setItem("toStatic",JSON.stringify({time:o.value})),window.sessionStorage.setItem("statisticDetails",JSON.stringify({staff:{text:w,value:t}})),l("StatisticDetails",{homeId:s,pageTp:e,qtime:o.value,fee:0})},M=()=>{p.value=!1,m=null},ae=e=>{e.value==="StatisticDetails"?(window.sessionStorage.setItem("toStatic",JSON.stringify({time:o.value})),l("StatisticDetails",{homeId:s,pageTp:2,fee:0,qtime:o.value,stfId:m.id})):l("ImpOperation",{homeId:s,id:m.id,currency:m.currency,doType:e.value}),M()},j=async()=>{const e=window.sessionStorage.getItem("toStatic");e&&(o.value=JSON.parse(e).time,window.sessionStorage.removeItem("toStatic")),L();const t=await S.getUseInfoHomeNum;R.value=t>1};return ce(()=>{var t;const e=(t=x.query)==null?void 0:t.homeId;s!==e&&(g.value=!0),s=e,j()}),re(async()=>{j()}),ue(()=>{m=null}),(e,t)=>{const w=y("SecondHeader"),v=y("DataInfoItem"),q=y("hk-empty"),se=y("MainContainer");return r(),de(se,{exitLoading:!0,pageLoading:g.value,isBg:!0},{header:f(()=>[a("div",null,[i(pe,{title:"管家系统"}),i(ve,{onOnSelectTime:W,timeValue:o.value},{title:f(()=>[Ae]),_:1},8,["timeValue"])])]),headerScreen:f(()=>[i(w,{noScreen:!0})]),default:f(()=>[a("div",Oe,[a("div",He,[i(ye,{data:O.value,haveInfoArrow:!1},null,8,["data"])]),i(Ne,{onOnFirBtnHandle:t[0]||(t[0]=()=>X()),onOnSecBtnHandle:t[1]||(t[1]=()=>Z()),contentNumber:A.value},null,8,["contentNumber"]),a("div",Pe,[a("div",Ce,[a("span",Le,"支出分类("+_(d.currency)+")",1),Me]),a("div",je,[(r(!0),u(U,null,J(d.list,(n,D)=>(r(),u("div",{class:"pay-class-item",key:D},[i(v,{valData:n,haveArrow:!0,onOnHandle:Y},null,8,["valData"])]))),128)),d.list.length===0?(r(),u("div",Be,[i(q)])):k("",!0)])]),a("div",qe,[Je,a("div",Ue,[(r(!0),u(U,null,J(I.value,(n,D)=>(r(),u("div",{class:"home-staff-item",key:D,onClick:b=>l("StaffDetails",{id:n.id,homeId:h(s)})},[a("div",Ve,[a("div",Qe,[a("img",{class:"home-staff-img",src:n.picture,alt:""},null,8,Re),a("div",Fe,_(h(Ie)(n.name,6)),1)]),a("div",ze,[i(v,{valData:n.jop,haveArrow:!0,onOnHandle:b=>l("StaffDetails",{id:n.id,homeId:h(s)})},null,8,["valData","onOnHandle"])])]),a("div",Ee,[a("div",Ke,[i(v,{haveArrow:!0,valData:n.residueImprest,onOnHandle:b=>ee({id:n.id,currency:n.currency})},{default:f(()=>[a("div",Ge,[a("span",We,_(h(we)(n.amount)),1),a("span",null,_(n.currency),1)])]),_:2},1032,["valData","onOnHandle"])]),n.identifyType!==3?(r(),u("div",Xe,[i(v,{valData:n.doTask,haveArrow:!0,onOnHandle:b=>te(3,n.id,n.name)},null,8,["valData","onOnHandle"])])):k("",!0)])],8,$e))),128)),I.value.length===0?(r(),u("div",Ye,[i(q)])):k("",!0)])])]),i(h(xe),{class:"hk-action-sheet",show:p.value,"onUpdate:show":t[2]||(t[2]=n=>p.value=n),actions:F.value,"cancel-text":"取消","close-on-click-action":"",onCancel:M,onSelect:ae},null,8,["show","actions"])]),_:1},8,["pageLoading"])}}});export{ot as default};
