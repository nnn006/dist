import{d as re,l as i,m as fe,g as me,p as pe,o as p,a as N,B as s,x as a,i as l,Q as c,e as T,f as g,L as P,S as d,H as be,_ as ge,r as f,a6 as R}from"./vue.BCHSKM6y.js";import{I as _e,u as he,h as ve,a3 as ye,y as Ie,a4 as xe,b as ke,c as Se,aA as Te,e as Re,aB as Ce,t as L,a6 as Ae,g as Me,ai as Ve}from"./index.Cjri3_sP.js";import{_ as u}from"./BaseInfoItem.vue_vue_type_style_index_0_lang.DMYgpoJW.js";import{A as De}from"./index.YYOoEeNT.js";import"./right-arrow-icon.CaFxgYzl.js";const He={class:"updata-staff-box hk-flex hk-flex-col container-setPx"},we={class:"updata-staff-form"},Ue={class:"info-no-input"},Oe={class:"info-no-input"},je={class:"info-no-input"},Be={class:"info-no-input"},Ne={class:"form-upload-img-box"},Pe={class:"form-upload-img-tit"},Le=l("span",null,"*",-1),qe={key:0,class:"form-upload-img"},Ye=l("div",{class:"footer-aux-btmbox"},null,-1),$e={class:"footer-btn-box"},Fe={class:"staff-edit-dialog"},Je={class:"pd-dialog-content"},Ee=l("p",null,"提示：请勿忘记线下收回备用金",-1),Ze=re({__name:"editDetails",setup(Qe){const{t:n}=ke(),_=i([]),C=_e.inApp(),A=ge(),q=he(),{isStaff:M}=ve(),h=new Date,Y=h.getFullYear(),$=h.getMonth(),F=h.getDate(),V=i(null),D=i(null),J=i(null),H=i(!0),v=i(null),w=i(null),y=i(!1),E=ye(),I=i(""),{comeback:Q,goback:z}=Se(),{hkMessage:r}=Me(),{id:x,homeId:G}=A.query,k=i(!1),t=fe({nickname:"",avatar:"",homeName:"",birthday:"",contactInformation:"",identifyMsgId:"",duties:"",country:"",joinTime:0,countryId:0,dutiesId:0}),K=me(()=>!!t.nickname&&!!t.country&&!!t.duties&&H.value),W=e=>{t.country=e.countryName,t.countryId=e.countryId},X=()=>{Te({identifyId:+x}).then(e=>{e.code===0?(t.avatar=e.data.avatar,t.nickname=e.data.nickname,t.homeName=e.data.homeName,t.birthday=e.data.birthday,t.contactInformation=e.data.contactInformation,t.identifyMsgId=e.data.identifyMsgId,t.country=e.data.country,t.duties=e.data.duties,t.joinTime=e.data.joinTime,t.countryId=e.data.countryId,t.dutiesId=e.data.dutiesId,_.value=[{url:Re+e.data.avatar,baseUrl:e.data.avatar}]):r(e.msg)}).catch(e=>{r(e)})},S=i([]),Z=()=>{k.value=!1},ee=e=>{t.duties=e.name,t.dutiesId=e.value},te=e=>{var o,b;t.duties=(o=e[0])==null?void 0:o.text,t.dutiesId=(b=e[0])==null?void 0:b.value},U=()=>{V.value.taggleVisible(!0)},O=()=>{D.value.taggleVisible()},ae=e=>{t.birthday=`${e[0]}-${e[1]}-${e[2]}`},oe=e=>{Ve({identifyId:+x,nickname:t.nickname,avatar:e,birthday:t.birthday,contactInformation:t.contactInformation,identifyMsgId:t.identifyMsgId,dutiesId:t.dutiesId,countryId:t.countryId}).then(o=>{o.code===0?(q.setUserIdent(),Q(),r("保存成功")):r(o.msg)}).catch(o=>{r(o)}).finally(()=>{y.value=!1})},ne=()=>{var o;y.value=!0;const e=(o=v.value)==null?void 0:o.getValues();oe(e[0])},se=()=>{Ce({identifyId:+x,homeId:+G}).then(e=>{e.code===0?z(-2):r(e.msg)}).catch(e=>{r(e)})},j=()=>{w.value.taggleVisible(!0)},B=e=>{H.value=e};return pe(async()=>{X(),I.value=A.query.tp||"other";const e=await E.getJob;S.value=e.map(o=>({text:o.text,value:o.value}))}),(e,o)=>{const b=f("UploadImg"),le=f("AppUploadImg"),ie=f("BtmSingleBtn"),ce=f("ConfrimPopAgain"),de=f("AreaSelect"),ue=f("DateSelect");return p(),N(be,null,[s(Ie,{title:I.value==="staff"?"编辑资料":I.value==="other"?a(n)("base.staffInfoTxt",{do:a(n)("base.editTxt")}):""},null,8,["title"]),l("div",He,[l("div",we,[s(u,{label:a(n)("base.nameTxt"),isRequire:!0},{default:c(()=>[s(a(L),{modelValue:t.nickname,"onUpdate:modelValue":o[0]||(o[0]=m=>t.nickname=m),placeholder:a(n)("base.pleaseInputTxt")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(M)?g("",!0):(p(),T(u,{key:0,label:a(n)("base.jopTxt"),isHaveRArrow:!0,isRequire:!0,onOnHandle:j},{default:c(()=>[l("div",{onClick:R(j,["stop"])},d(t.duties),1)]),_:1},8,["label"])),a(M)?(p(),T(u,{key:1,label:a(n)("base.jopTxt")},{default:c(()=>[l("div",Ue,d(t.duties),1)]),_:1},8,["label"])):g("",!0),s(u,{label:a(n)("base.belongHomeTxt")},{default:c(()=>[l("div",Oe,d(t.homeName),1)]),_:1},8,["label"]),s(u,{label:a(n)("base.nationTxt"),isHaveRArrow:!0,isRequire:!0,onOnHandle:U},{default:c(()=>[l("div",{onClick:R(U,["stop"])},d(t.country),1)]),_:1},8,["label"]),s(u,{label:a(n)("base.idCard")},{default:c(()=>[s(a(L),{modelValue:t.identifyMsgId,"onUpdate:modelValue":o[1]||(o[1]=m=>t.identifyMsgId=m),placeholder:a(n)("base.pleaseInputTxt")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(u,{label:a(n)("base.telNotxt")},{default:c(()=>[l("div",je,d(t.contactInformation||"未绑定"),1)]),_:1},8,["label"]),s(u,{label:a(n)("base.birthdayTxt"),isHaveRArrow:!0,isRequire:!0,onOnHandle:O},{default:c(()=>[l("div",{onClick:R(O,["stop"])},d(t.birthday),1)]),_:1},8,["label"]),s(u,{label:a(n)("base.entryTime")},{default:c(()=>[l("div",Be,d(a(Ae)(t.joinTime*1e3).format("YYYY-MM-DD HH:mm")),1)]),_:1},8,["label"]),l("div",Ne,[l("div",Pe,[P(d(a(n)("base.pictrueTxt")),1),Le]),a(C)?g("",!0):(p(),N("div",qe,[s(b,{ref_key:"uploadImgRef",ref:v,fileValues:_.value,maxCount:1,onOnChangeIsLength:B},null,8,["fileValues"])])),a(C)?(p(),T(le,{key:1,ref_key:"uploadImgRef",ref:v,value:_.value,onOnChangeImg:B},null,8,["value"])):g("",!0)])]),Ye,l("div",$e,[s(ie,{loading:y.value,disable:K.value,handleTxt:a(n)("base.btn.save"),onOnHandle:ne},null,8,["loading","disable","handleTxt"])])]),s(a(De),{class:"hk-action-sheet",show:k.value,"onUpdate:show":o[2]||(o[2]=m=>k.value=m),actions:S.value,"cancel-text":"取消","close-on-click-action":"",onCancel:Z,onSelect:ee},null,8,["show","actions"]),s(ce,{ref_key:"confirmPopRef",ref:J,popClass:"staff-edit-dialog-box",customFooter:!0,onOnConfirm:se},{default:c(()=>[l("div",Fe,[l("div",Je,[P(d(a(n)("base.confirmDelStaff"))+" ",1),Ee])])]),_:1},512),s(de,{ref_key:"areaSelectRef",ref:V,title:a(n)("base.countryTxt"),onOnChange:W},null,8,["title"]),s(ue,{ref_key:"dateSelectRef",ref:D,maxLimit:new Date(a(Y),a($),a(F)),onOnChangeVal:ae},null,8,["maxLimit"]),s(xe,{ref_key:"jopPopoverRef",ref:w,title:"职务",data:S.value,onOnChange:te},null,8,["data"])],64)}}});export{Ze as default};
