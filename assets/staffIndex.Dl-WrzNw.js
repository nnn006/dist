import{_ as K}from"./right-arrow-icon.CaFxgYzl.js";import{u as Q,a as R,b as q,c as G,s as W,F as L,_ as X,B as Y,d as Z,e as ee,f as se,g as te}from"./index.Cjri3_sP.js";import{A as ae}from"./index.YYOoEeNT.js";import{d as oe,l as u,m as ne,g as C,p as ce,k as ie,o as b,e as le,Q as S,x as i,r as d,B as o,i as s,S as T,L as P,n as U,a as k,R as re,f as ue,H as fe}from"./vue.BCHSKM6y.js";const me="/assets/staff-pay-icon.p0PnBrAR.png",de="/assets/staff-car-icon.DtiDtyRt.png",ve="/assets/staff-carAct-icon.mfJneek-.png",he="/assets/staff-watter-icon.n86EStAD.png",_e="/assets/staff-msg-icon.KoBhP8sU.png",pe={class:"staff-home-box"},ge={class:"staff-home-info"},Ie={class:"stfhome-staff-t hk-flex hk-jbetween"},Ce=["src"],be={class:"stfhome-staff-name hk-flex"},Se={class:"stfhome-staff-tr"},Te={class:"stahi-b hk-flex"},ke={class:"stahi-item"},we={class:"stahi-item"},xe={class:"stfhome-staff-b stahi-b hk-flex"},ye=s("div",{class:"stahi-item hk-flex hk-items-center"}," 待处理消息 ",-1),Be={class:"stahi-item hk-flex hk-items-center"},Ae={class:"sf-imp-wn-box"},Le={class:"staff-home-content hk-flex"},Pe=["onClick"],Ue={class:"stahc-item-label hk-flex hk-jbetween hk-items-center"},Ne=s("img",{class:"stahc-item-arraw",src:K,alt:"",srcset:""},null,-1),Oe={class:"stahc-item-icon"},ze=["src"],Me={key:0,class:"stahc-item-time"},Je=oe({name:"StaffIndex",__name:"staffIndex",setup(He){const{t:v}=q(),n=Q(),{pageLoading:N,endPageLoading:O}=R({activeAction:A}),{pushName:l,replacePath:Ve}=G(),{hkMessage:z}=te(),h=u(0),t=ne({useCarTimeOut:null,useCarTime:"",useCarStartTime:0,serverTime:0}),w=u(""),r=u(1),_=u(!1),x=u({label:"homeItem.residueImprest",value:0,type:"number"}),y=u({label:"本月出车",value:0,type:"time",doLabel:!1}),M=C(()=>ee+n.userInfo.avatar),H=C(()=>se(n.userInfo.nickname,6)),V=C(()=>n.userInfo.duties),$=C(()=>[{label:v("base.payTxt"),icon:me,router:"Pay"},{label:r.value===1?v("base.useCarTxt"):"出车中",icon:r.value===1?ve:de,class:r.value===1?[]:["icon-other-size"],router:"UseCar"},{label:v("base.footer.imprest"),icon:he,router:"ImpApply"},{label:v("base.recordTxt"),icon:_e,router:"StaffRecord"}]),F=u([{name:"支出记录",value:"StaffRecord"},{name:"出车记录",value:"StaffCarRecord"},{name:"备用金记录",value:"StfImprestRecord"}]),j=e=>{var a;e==="Pay"?l(e,{homeId:n.userInfo.homeId,currency:w.value,payRole:1}):e==="StaffRecord"?_.value=!0:e==="UseCar"?(a=n.userInfo.permission)!=null&&a[1]?l(e):r.value===1?z("暂无出车权限"):l(e):l(e)},D=()=>{_.value=!1},E=e=>{l(e.value)},B=()=>{t.useCarTimeOut=setTimeout(()=>{t.serverTime+=60,t.useCarTime=L(t.serverTime-t.useCarStartTime),B()},60*1e3)};async function A(){var a,m,p,g,f,I;const e=await W({homeId:n.userInfo.homeId});x.value.value=(a=e==null?void 0:e.data)==null?void 0:a.amount,y.value.value=(m=e==null?void 0:e.data)==null?void 0:m.useCarTime,w.value=(p=e==null?void 0:e.data)==null?void 0:p.currency,r.value=(g=e==null?void 0:e.data)==null?void 0:g.useCarStatus,r.value===2&&(t.serverTime=((f=e==null?void 0:e.data)==null?void 0:f.nowTime)||0,t.useCarStartTime=((I=e==null?void 0:e.data)==null?void 0:I.startTime)||0,t.useCarTime=L(t.serverTime-t.useCarStartTime),B()),h.value=n.untreatedSelfNum,n.setUserIdent(),O()}return ce(async()=>{A()}),ie(()=>{t.useCarTimeOut&&(clearTimeout(t.useCarTimeOut),t.useCarTimeOut=null)}),(e,a)=>{const m=d("SvgIcon"),p=d("LogoutBtn"),g=d("SecondHeader"),f=d("DataInfoItem"),I=d("MainContainer");return b(),le(I,{exitLoading:!0,pageLoading:i(N)},{default:S(()=>[o(X,{haveAdd:!1,haveMonth:!1,newsRoute:"news"},{comeback:S(()=>[o(p,null,{default:S(()=>[o(m,{class:"close-app-btnicon",iconClass:"close-app-btn",color:"#ffffff"})]),_:1})]),_:1}),s("div",pe,[o(g,{noScreen:!0}),s("div",ge,[s("div",Ie,[s("div",{class:"stfhome-staff-tl",onClick:a[0]||(a[0]=c=>i(l)("StaffDetails",{id:i(n).userInfo.identifyId,homeId:i(n).userInfo.homeId,tp:"staff"}))},[s("img",{class:"stfhome-staff-img",src:M.value,alt:""},null,8,Ce),s("div",be,[s("span",null,T(H.value),1),o(m,{iconClass:"right-arrow-icon",size:"12",color:"#999999"})])]),s("div",Se,[o(f,{valData:{label:"职务",type:"type",value:V.value},haveArrow:!1},null,8,["valData"])])]),s("div",Te,[s("div",ke,[o(f,{valData:x.value},null,8,["valData"])]),s("div",we,[o(f,{valData:y.value},null,8,["valData"])])]),s("div",xe,[ye,s("div",Be,[s("div",Ae,[o(i(Y),{class:"sf-imp-wn-badge",content:h.value,"show-zero":!1},null,8,["content"]),o(i(Z),{plain:"",class:U(["sf-imp-wn-btn",{active:h.value>0}]),size:"mini",onClick:a[1]||(a[1]=c=>i(l)("StaffNews"))},{default:S(()=>[P(T(h.value>0?"去处理":"暂无消息"),1)]),_:1},8,["class"])])])])]),s("div",Le,[(b(!0),k(fe,null,re($.value,(c,J)=>(b(),k("div",{class:"stahc-item ripple-effect-card",key:J,onClick:$e=>j(c.router)},[s("div",Ue,[P(T(c.label)+" ",1),Ne]),s("div",Oe,[s("img",{src:c.icon,class:U(c.class),alt:"",srcset:""},null,10,ze)]),c.router==="UseCar"&&r.value===2?(b(),k("div",Me,"已出车: "+T(t.useCarTime),1)):ue("",!0)],8,Pe))),128))])]),o(i(ae),{class:"hk-action-sheet",show:_.value,"onUpdate:show":a[2]||(a[2]=c=>_.value=c),actions:F.value,"cancel-text":"取消","close-on-click-action":"",onCancel:D,onSelect:E},null,8,["show","actions"])]),_:1},8,["pageLoading"])}}});export{Je as default};
