import{l as ce,r as l,R as de,i as re,b as ue,a as me,d as fe,K as r,L as k,U as H,V as c,k as o,u as n,N as i,M as pe,S as L,O as m,a6 as V,D as he}from"./vue.C2TeXnf4.js";import{I as ge,q as _e,j as be,d as ve,s as ye,f as Ie,t as ke,n as xe,k as Se,u as Te,p as Me,o as Re,r as Ce,a as De,v as we}from"./index.C__3lhMr.js";import{_ as u}from"./BaseInfoItem.vue_vue_type_style_index_0_lang.MpSsZcmr.js";import{A as Ae}from"./index.DcHIdklB.js";import"./right-arrow-icon.CaFxgYzl.js";const He={class:"updata-staff-box hk-flex hk-flex-col container-setPx"},Le={class:"updata-staff-form"},Ve={key:0,class:"personal-deatils-upimg"},Oe={class:"info-no-input"},Ue={class:"info-no-input"},Be=i("div",{class:"footer-aux-btmbox"},null,-1),Ne={class:"footer-btn-box"},Pe={class:"staff-edit-dialog"},je={class:"pd-dialog-content"},Fe=i("p",null,"提示：请勿忘记线下收回备用金",-1),Ke=ce({__name:"editDetails",setup(Ye){const{t:s}=Te(),p=l([]),O=de(),h=new Date,U=re("endPageLoading"),x=ge.inApp(),B=h.getFullYear(),N=h.getMonth(),P=h.getDate(),j=l(null),S=l(null),F=l(null);_e();const T=be(),g=l(!1),M=l([]),f=l([]),{comeback:Y,goback:$}=ve(),{hkMessage:d}=De();ye();const{id:_,homeId:q}=O.query,R=l(null),C=l(!0),b=l(null),v=l(!1),a=ue({nickname:"",avatar:"",homeName:"",birthday:"",contactInformation:"",identifyMsgId:"",duties:"",country:"",joinTime:0,countryId:0,dutiesId:0}),E=me(()=>!!a.nickname&&!!a.birthday&&C.value),G=t=>{a.country=t.countryName,a.countryId=t.countryId},J=t=>{Me({identifyId:+_}).then(e=>{e.code===0?(a.avatar=e.data.avatar,a.nickname=e.data.nickname,a.homeName=e.data.homeName,a.birthday=e.data.birthday,a.contactInformation=e.data.contactInformation,a.identifyMsgId=e.data.identifyMsgId,a.country=e.data.country,a.duties=e.data.duties,a.joinTime=e.data.joinTime,a.countryId=e.data.countryId,a.dutiesId=e.data.dutiesId,p.value=[{url:Re+e.data.avatar,baseUrl:e.data.avatar}],f.value=e.data.familyMemberHomeList.map(y=>y.homeId)):d(e.msg)}).finally(()=>{t&&t()})},K=l([]),z=()=>{v.value=!1},Q=t=>{a.duties=t.name,a.dutiesId=t.value},D=()=>{S.value.taggleVisible()},W=t=>{a.birthday=`${t[0]}-${t[1]}-${t[2]}`},X=t=>{we({identifyId:+_,nickname:a.nickname,avatar:t,birthday:a.birthday,contactInformation:a.contactInformation,identifyMsgId:a.identifyMsgId,countryId:a.countryId,homeIds:f.value}).then(e=>{e.code===0?(d("保存成功"),Y()):d(e.msg)}).catch(e=>{d(e)}).finally(()=>{g.value=!1})},Z=()=>{var e;g.value=!0;const t=(e=b.value)==null?void 0:e.getValues();X(t[0])},ee=t=>{f.value=t.map(e=>e.value)},w=()=>{R.value.taggleVisible(!0)},ae=()=>{Ce({identifyId:+_,homeId:+q}).then(t=>{t.code===0?(d("离职成功"),$(-2)):d(t.msg)}).catch(t=>{d(t)})},A=t=>{C.value=t};return fe(async()=>{J(U),await T.setHomeSimpleLs();const t=await T.homeSimple;M.value.push(...t)}),(t,e)=>{const y=r("UploadImg"),te=r("AppUploadImg"),ne=r("BtmSingleBtn"),oe=r("ConfrimPopAgain"),se=r("AreaSelect"),le=r("DateSelect"),ie=r("MainContainer");return k(),H(ie,null,{header:c(()=>[o(Ie,{title:n(s)("base.familyDetails",{do:n(s)("base.editTxt")})},null,8,["title"])]),default:c(()=>[i("div",He,[i("div",Le,[o(u,{class:"pd-img",label:"照片",isHaveRArrow:!0,isRequire:!0},{default:c(()=>[n(x)?L("",!0):(k(),pe("div",Ve,[o(y,{isDelete:!1,ref_key:"uploadImgRef",ref:b,fileValues:p.value,maxCount:1,onOnChangeIsLength:A},null,8,["fileValues"])])),n(x)?(k(),H(te,{key:1,class:"personal-deatils-upimg",ref_key:"uploadImgRef",ref:b,value:p.value,onOnChangeImg:A},null,8,["value"])):L("",!0)]),_:1}),o(u,{label:n(s)("base.nameTxt"),isRequire:!0},{default:c(()=>[o(n(ke),{modelValue:a.nickname,"onUpdate:modelValue":e[0]||(e[0]=I=>a.nickname=I),placeholder:n(s)("base.pleaseInputTxt")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(u,{label:n(s)("base.telNotxt")},{default:c(()=>[i("div",Oe,m(a.contactInformation),1)]),_:1},8,["label"]),o(u,{label:n(s)("base.birthdayTxt"),isHaveRArrow:!0,isRequire:!0,onOnHandle:D},{default:c(()=>[i("div",{onClick:V(D,["stop"])},m(a.birthday),1)]),_:1},8,["label"]),o(u,{label:n(s)("base.registerTimeTxt")},{default:c(()=>[i("div",Ue,m(n(xe)(a.joinTime*1e3).format("YYYY-MM-DD HH:mm")),1)]),_:1},8,["label"]),o(u,{label:n(s)("base.manageFamilyTxt"),isHaveRArrow:!0,onOnHandle:w},{default:c(()=>[i("div",{class:"staff-details-clickview",onClick:V(w,["stop"])},m(n(s)("base.selectFamilyTxt")),1)]),_:1},8,["label"])]),Be,i("div",Ne,[o(ne,{disable:E.value,loading:g.value,handleTxt:n(s)("base.btn.save"),onOnHandle:Z},null,8,["disable","loading","handleTxt"])])]),o(n(Ae),{class:"hk-action-sheet",show:v.value,"onUpdate:show":e[1]||(e[1]=I=>v.value=I),actions:K.value,"cancel-text":"取消","close-on-click-action":"",onCancel:z,onSelect:Q},null,8,["show","actions"]),o(Se,{ref_key:"feeTypePopRef",ref:R,title:n(s)("base.manageFamilyTxt"),isSingle:!1,showBtmBtn:!0,value:f.value,data:M.value,onOnChange:ee},null,8,["title","value","data"]),o(oe,{ref_key:"confirmPopRef",ref:F,popClass:"staff-edit-dialog-box",customFooter:!0,onOnConfirm:ae},{default:c(()=>[i("div",Pe,[i("div",je,[he(m(n(s)("base.confirmDelStaff"))+" ",1),Fe])])]),_:1},512),o(se,{ref_key:"areaSelectRef",ref:j,title:n(s)("base.countryTxt"),onOnChange:G},null,8,["title"]),o(le,{ref_key:"dateSelectRef",ref:S,maxLimit:new Date(n(B),n(N),n(P)),onOnChangeVal:W},null,8,["maxLimit"])]),_:1})}}});export{Ke as default};
