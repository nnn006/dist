import{d as te,z as k,F as se,u as oe,a as ie,b as ne}from"./index.C__3lhMr.js";import{_ as le}from"./TabHeader.vue_vue_type_style_index_0_lang.BLGXvztv.js";import{l as re,R as ce,r as d,b as ue,e as I,d as me,K as g,L as z,U as fe,V as p,k as m,u as s,N as c,O as h,z as pe,M as ve,S as de,a5 as ge,D as B}from"./vue.C2TeXnf4.js";import{_ as ye}from"./StatisticTotal.vue_vue_type_style_index_0_lang.CYzONwwI.js";import{_ as be}from"./NewsItem.vue_vue_type_style_index_0_lang.C3OnuWsN.js";import{a as he,b as _e,s as Se}from"./index.DNWpiEF6.js";import{u as Te}from"./useConfigBaseInfo.CxjUSntV.js";const Ce={class:"stic-details-box"},Ne={class:"screen-box hk-flex hk-jbetween hk-w-full"},we={class:"screen-item"},De={class:"screen-item"},ke={class:"item-mr-24"},qe={class:"hk-flex hk-items-center"},Oe={class:"head-select-value"},Pe={class:"head-select-value"},xe={key:0},Le={class:"head-select-value"},Ve={class:"statistic-total-desc"},Re={class:"stic-details-list sticp-details-list"},Ee=re({name:"StatisticDetails",__name:"details",setup(Me){const{t:q}=oe(),{pushName:_}=te(),{hkMessage:A}=ie(),r=ce(),e=d(r.query.pageTp),O=d(null),P=d(null),S=d([]),T=d(null),C=d(null),t=ue({page:1,pageSize:10,total:0,curTime:new Date().getTime(),allPayMoney:0,currency:""}),{showLoading:N,closeLoading:w}=ne(),D=async(i,a)=>{o[a]=i,a==="home"&&(o.staff={text:q("base.screen.allStaff"),value:0},o.member={text:"人员",value:0},o.type={text:q("base.screen.allType"),value:0},e.value==="1"?F():U(),W(o[a].value)),t.page=1,N(),await y(),w()},y=()=>new Promise(i=>{const a={page:t.page,pageSize:t.pageSize,homeId:o.home.value,selectTime:Math.floor(t.curTime/1e3),selectTimeTyp:u.value,identifyId:e.value==="1"?o.member.value:o.staff.value};Number(e.value)===1&&(a.expenseTypeId=o.type.value),(Number(e.value)===1?he:Number(e.value)===2?_e:Se)(a).then(l=>{if(l.code===0){const v=l.data.list.map(n=>({id:n.id,title:n.title,value:Number(e.value)===3?n.useCarTime:Number(e.value)===2?n.amount:n.payMoney,type:Number(e.value)===3?"time":"price",currencyType:n.currency,pic:n.identifyAvatar,applyState:n.status,active:!1,homeName:n.homeName,identifyName:n.identifyName,applicationTime:n.applicationTime,status:n.status,useCarTime:n.useCarTime,endTime:n.endTime,startTime:n.startTime,typ:n.typ}));a.page===1?S.value=v:S.value.push(...v),t.total=l.data.total,t.allPayMoney=Number(e.value)===3?l.data.allUseCarTime:Number(e.value)===2?l.data.allAmount:l.data.allPayMoney,t.currency=l.data.currency,C.value=l.data.overtimeUseCarTime}else A(l.msg)}).finally(()=>{var l,v;(l=T.value)==null||l.taggleRefreshState("isLoading",!1),(v=T.value)==null||v.taggleRefreshState("loading",!1),i(!0)})}),{homeSelectData:H,hTabData:J,feeOption:$,screenVal:o,curValue:u,carTabData:j,imprestTabData:E,staffOption:x,getMemberList:F,getStaffList:U,getFeeOption:W,memberOption:L,pageLoading:V}=Te({loadList:async()=>{t.page=1,await y()},type:e.value}),K=i=>{window.sessionStorage.setItem("statisticDetails",JSON.stringify({staff:e.value==="1"?o.member:o.staff,fee:o.type,home:o.home,time:t.curTime,tabVal:u.value})),Number(e.value)===1||Number(e.value)===3?_("PayDetails",{id:i.id}):Number(e.value)===2&&_("NewsDetails",{id:i.id,tp:i.typ,pgTp:1})},R=()=>{window.sessionStorage.setItem("statisticDetails",JSON.stringify({staff:o.staff,home:o.home,time:t.curTime,tabVal:u.value})),_("WorkOvertime")},G=async i=>{u.value=i,t.page=1,N(),await M(),w()},Q=()=>{t.page++,y()},M=async()=>{t.page=1,await y()},X=async i=>{t.curTime=new Date(i).getTime(),t.page=1,N(),await y(),w()},Y=()=>{O.value.visiblePopover()},Z=()=>{P.value.visiblePopover()};return I(()=>{r.query.qtime&&(t.curTime=Number(r.query.qtime)),r.query.qtab&&(u.value=Number(r.query.qtab));const i=r.query.pageTp;i!==e.value&&(e.value=i,V.value=!0);const a=window.sessionStorage.getItem("statisticDetails");if(a){const b=JSON.parse(a);b.tabVal&&(u.value=b.tabVal)}e.value=r.query.pageTp}),me(()=>{r.query.qtime&&(t.curTime=Number(r.query.qtime)),r.query.qtab&&(u.value=Number(r.query.qtab));const i=window.sessionStorage.getItem("statisticDetails");if(i){const a=JSON.parse(i);a.time&&(t.curTime=a.time),a.tabVal&&(u.value=a.tabVal)}}),I(()=>{r.query.qtime&&(t.curTime=Number(r.query.qtime)),r.query.qtab&&(u.value=Number(r.query.qtab));const i=window.sessionStorage.getItem("statisticDetails");if(i){const a=JSON.parse(i);a.time&&(t.curTime=a.time),a.tabVal&&(u.value=a.tabVal)}}),(i,a)=>{const b=g("MonthSelect"),l=g("SvgIcon"),v=g("HkPopover"),n=g("SecondHeader"),ee=g("DownRefresh"),ae=g("MainContainer");return z(),fe(ae,{exitLoading:!0,pageLoading:s(V)},{header:p(()=>[m(le,{curValue:s(u),tabConetnt:e.value==="3"?s(j):e.value==="2"?s(E):s(J),onOnChange:G},null,8,["curValue","tabConetnt"])]),headerScreen:p(()=>[c("div",Ce,[m(n,{exitStatistic:!0},{default:p(()=>[c("div",Ne,[c("div",we,[m(b,{onOnTimeChange:X,value:t.curTime,dateType:s(u)},null,8,["value","dateType"])]),c("div",De,[c("div",ke,[m(v,{options:s(H),value:s(o).home.value,pannelClass:"stic-minw-140",placement:"bottom-end",offset:[0,18],isSelectState:!0,onOnChange:a[0]||(a[0]=f=>D(f,"home"))},{taggleEle:p(()=>[c("div",qe,[c("span",Oe,h(s(k)(s(o).home.text)),1),m(l,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value"])]),c("div",{class:pe({"item-mr-24":e.value==="1"})},[m(v,{ref_key:"staffPopoverRef",ref:P,trigger:"manual",options:e.value==="1"?s(L):s(x),value:s(o)[e.value==="1"?"member":"staff"].value,pannelClass:"stic-minw-140",placement:"bottom-end",offset:[0,18],isSplitBorder:e.value==="1"?s(L).length<=1?[]:[0]:s(x).length<=1?[]:[0],isSelectState:!0,noDataTips:`暂无${e.value==="1"?"人员":"员工"}`,onOnChange:a[1]||(a[1]=f=>D(f,e.value==="1"?"member":"staff"))},{taggleEle:p(()=>[c("div",{class:"hk-flex hk-items-center",onClick:Z},[c("span",Pe,h(s(k)(s(o)[e.value==="1"?"member":"staff"].text)),1),m(l,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value","isSplitBorder","noDataTips"])],2),e.value==="1"?(z(),ve("div",xe,[m(v,{ref_key:"feePopoverRef",ref:O,options:s($),trigger:"manual",value:s(o).type.value,pannelClass:"stic-minw-140",placement:"bottom-end",offset:[0,18],isSplitBorder:[0],isSelectState:!0,noDataTips:"暂无费用类型",onOnChange:a[2]||(a[2]=f=>D(f,"type"))},{taggleEle:p(()=>[c("div",{class:"hk-flex hk-items-center",onClick:Y},[c("span",Le,h(s(k)(s(o).type.text)),1),m(l,{iconClass:"down-select-svg",size:"9",color:"#ffffff"})])]),_:1},8,["options","value"])])):de("",!0)])])]),_:1})])]),headerStatistic:p(()=>[m(ye,{total:t.total,type:Number(e.value)===1?"number":Number(e.value)===2?"imprest":"time",value:t.allPayMoney,currency:t.currency,onOnDescHandle:R},ge({_:2},[C.value&&s(u)===2?{name:"desc",fn:p(()=>[c("span",Ve,[B("(加班："),c("span",{onClick:R},h(s(se)(C.value)),1),B(" >)")])]),key:"0"}:void 0]),1032,["total","type","value","currency"])]),default:p(()=>[c("div",Re,[m(ee,{ref_key:"downRefreshRef",ref:T,dataList:S.value,pagination:t,onOnRefresh:M,onOnLoad:Q},{default:p(({data:f})=>[m(be,{data:f,valColorClass:f.typ===7||f.typ===6?["val-color-yellow"]:f.typ===5?["val-color-blue"]:[],onClick:Ie=>K(f)},null,8,["data","valColorClass","onClick"])]),_:1},8,["dataList","pagination"])])]),_:1},8,["pageLoading"])}}});export{Ee as default};
